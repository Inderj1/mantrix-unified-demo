<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STOX.AI - Forecasting Engine</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0F172A;
            --bg-secondary: #1E293B;
            --bg-tertiary: #334155;
            --text-primary: #F8FAFC;
            --text-secondary: #94A3B8;
            --text-muted: #64748B;
            --cyan: #06B6D4;
            --cyan-dark: #0891B2;
            --emerald: #10B981;
            --amber: #F59E0B;
            --red: #EF4444;
            --purple: #8B5CF6;
            --pink: #EC4899;
            --blue: #3B82F6;
            --wharton-blue: #004785;
            --wharton-maroon: #A90533;
            --border: #475569;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .header-left h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--purple);
            font-family: 'JetBrains Mono', monospace;
        }

        .header-left p {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 4px;
        }

        .header-right {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .run-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--purple), var(--pink));
            border: none;
            color: white;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .run-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        /* Summary Cards */
        .summary-strip {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .summary-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }

        .summary-card:hover {
            border-color: var(--purple);
            transform: translateY(-2px);
        }

        .summary-card .label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .summary-card .value {
            font-size: 28px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .summary-card .subtext {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .summary-card.excellent .value { color: var(--emerald); }
        .summary-card.good .value { color: var(--cyan); }
        .summary-card.fair .value { color: var(--amber); }
        .summary-card.poor .value { color: var(--red); }
        .summary-card.info .value { color: var(--purple); }

        /* Filter Bar */
        .filter-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .filter-group select {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
        }

        .filter-group select:focus {
            outline: none;
            border-color: var(--purple);
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            max-width: 300px;
        }

        .search-box input {
            width: 100%;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--purple);
        }

        /* Main Table */
        .table-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .data-table thead {
            background: var(--bg-tertiary);
            position: sticky;
            top: 0;
        }

        .data-table th {
            padding: 14px 12px;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
        }

        .data-table th .sap-field {
            display: block;
            font-size: 9px;
            color: var(--text-muted);
            font-weight: 400;
            margin-top: 2px;
            font-family: 'JetBrains Mono', monospace;
        }

        .data-table tbody tr {
            cursor: pointer;
            transition: background 0.15s;
        }

        .data-table tbody tr:hover {
            background: rgba(139, 92, 246, 0.1);
        }

        .data-table td {
            padding: 14px 12px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .data-table .material-cell {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--purple);
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-smooth { background: rgba(16, 185, 129, 0.2); color: var(--emerald); }
        .badge-seasonal { background: rgba(139, 92, 246, 0.2); color: var(--purple); }
        .badge-erratic { background: rgba(239, 68, 68, 0.2); color: var(--red); }
        .badge-intermittent { background: rgba(245, 158, 11, 0.2); color: var(--amber); }
        .badge-lumpy { background: rgba(236, 72, 153, 0.2); color: var(--pink); }

        .model-badge {
            background: rgba(59, 130, 246, 0.2);
            color: var(--blue);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Indicators */
        .indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .indicator-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .indicator-dot.green { background: var(--emerald); }
        .indicator-dot.yellow { background: var(--amber); }
        .indicator-dot.orange { background: #F97316; }
        .indicator-dot.red { background: var(--red); }

        /* Forecast Range Display */
        .forecast-range {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .forecast-point {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            font-size: 13px;
        }

        .forecast-interval {
            font-size: 10px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Confidence Band Visual */
        .confidence-band {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .band-visual {
            width: 80px;
            height: 20px;
            position: relative;
            background: linear-gradient(90deg, 
                rgba(139, 92, 246, 0.1) 0%, 
                rgba(139, 92, 246, 0.4) 25%, 
                rgba(139, 92, 246, 0.6) 50%, 
                rgba(139, 92, 246, 0.4) 75%, 
                rgba(139, 92, 246, 0.1) 100%);
            border-radius: 4px;
        }

        .band-marker {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 14px;
            background: var(--purple);
            border-radius: 2px;
        }

        .band-width {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* MAPE Gauge */
        .mape-gauge {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mape-bar {
            width: 60px;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }

        .mape-bar-fill {
            height: 100%;
            border-radius: 3px;
        }

        .mape-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            font-size: 13px;
        }

        /* Bias Display */
        .bias-display {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .bias-bar {
            width: 60px;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            position: relative;
        }

        .bias-center {
            position: absolute;
            left: 50%;
            top: 0;
            width: 1px;
            height: 100%;
            background: var(--text-muted);
        }

        .bias-indicator {
            position: absolute;
            top: 0;
            height: 100%;
            border-radius: 3px;
        }

        .bias-indicator.positive {
            left: 50%;
            background: var(--amber);
        }

        .bias-indicator.negative {
            right: 50%;
            background: var(--cyan);
        }

        .bias-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
        }

        .bias-value.positive { color: var(--amber); }
        .bias-value.negative { color: var(--cyan); }
        .bias-value.neutral { color: var(--text-secondary); }

        /* Detail View */
        .detail-view {
            display: none;
        }

        .detail-view.active {
            display: block;
        }

        .list-view.hidden {
            display: none;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 20px;
            transition: all 0.2s;
        }

        .back-btn:hover {
            border-color: var(--purple);
            background: var(--bg-tertiary);
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }

        .detail-title {
            font-size: 24px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--purple);
        }

        .detail-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 4px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .detail-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
        }

        .detail-card h3 {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-card h3 .icon {
            font-size: 18px;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .metric-label .sap-ref {
            display: block;
            font-size: 10px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        .metric-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            font-size: 14px;
        }

        /* Large Forecast Display */
        .forecast-display {
            text-align: center;
            padding: 20px;
        }

        .forecast-main {
            font-size: 48px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--purple);
        }

        .forecast-range-text {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 8px;
            font-family: 'JetBrains Mono', monospace;
        }

        .forecast-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Model Comparison */
        .model-comparison {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .model-option {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            border: 2px solid transparent;
        }

        .model-option.selected {
            border-color: var(--purple);
            background: rgba(139, 92, 246, 0.1);
        }

        .model-option .model-name {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .model-option .model-mape {
            font-size: 11px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Forecast Chart Visualization */
        .forecast-chart {
            position: relative;
            height: 200px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 20px;
            margin-top: 16px;
        }

        .chart-area {
            position: relative;
            height: 100%;
            display: flex;
            align-items: flex-end;
            gap: 8px;
        }

        .chart-bar-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .chart-bar {
            width: 100%;
            border-radius: 4px 4px 0 0;
            position: relative;
        }

        .chart-bar.actual {
            background: var(--cyan);
        }

        .chart-bar.forecast {
            background: var(--purple);
            opacity: 0.8;
        }

        .chart-bar.confidence {
            position: absolute;
            width: 100%;
            background: rgba(139, 92, 246, 0.2);
            border: 1px dashed var(--purple);
        }

        .chart-label {
            font-size: 10px;
            color: var(--text-muted);
        }

        /* Navigation Cards */
        .nav-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-top: 24px;
        }

        .nav-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-card:hover {
            border-color: var(--purple);
            transform: translateY(-2px);
        }

        .nav-card .nav-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .nav-card .nav-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .nav-card .nav-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--text-muted);
            font-size: 12px;
            border-top: 1px solid var(--border);
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1>üîÆ Forecasting Engine</h1>
                <p>Layer 2: Predictive ‚Äî AI-powered demand forecasting with auto model selection</p>
            </div>
            <div class="header-right">
                <button class="run-btn">
                    ‚ö° Run Forecast
                </button>
            </div>
        </div>

        <!-- Summary Strip -->
        <div class="summary-strip">
            <div class="summary-card excellent">
                <div class="label">üéØ Excellent Accuracy</div>
                <div class="value">156</div>
                <div class="subtext">MAPE &lt; 15%</div>
            </div>
            <div class="summary-card good">
                <div class="label">‚úÖ Good Accuracy</div>
                <div class="value">243</div>
                <div class="subtext">MAPE 15-30%</div>
            </div>
            <div class="summary-card fair">
                <div class="label">‚ö†Ô∏è Fair Accuracy</div>
                <div class="value">89</div>
                <div class="subtext">MAPE 30-50%</div>
            </div>
            <div class="summary-card poor">
                <div class="label">‚ùå Poor Accuracy</div>
                <div class="value">34</div>
                <div class="subtext">MAPE &gt; 50%</div>
            </div>
            <div class="summary-card info">
                <div class="label">üìà Over-Forecasting</div>
                <div class="value">78</div>
                <div class="subtext">Bias &gt; +10%</div>
            </div>
            <div class="summary-card info">
                <div class="label">üìâ Under-Forecasting</div>
                <div class="value">45</div>
                <div class="subtext">Bias &lt; -10%</div>
            </div>
        </div>

        <!-- List View -->
        <div class="list-view" id="listView">
            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="filter-group">
                    <label>Plant:</label>
                    <select id="filterPlant">
                        <option value="all">All Plants</option>
                        <option value="P100">P100 - US East</option>
                        <option value="P200">P200 - US West</option>
                        <option value="P300">P300 - EU</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Model:</label>
                    <select id="filterModel">
                        <option value="all">All Models</option>
                        <option value="SES">SES</option>
                        <option value="Holt-Winters">Holt-Winters</option>
                        <option value="Croston">Croston</option>
                        <option value="SBA">SBA</option>
                        <option value="Damped Trend">Damped Trend</option>
                        <option value="Ensemble">Ensemble</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Accuracy:</label>
                    <select id="filterAccuracy">
                        <option value="all">All</option>
                        <option value="excellent">Excellent (&lt;15%)</option>
                        <option value="good">Good (15-30%)</option>
                        <option value="fair">Fair (30-50%)</option>
                        <option value="poor">Poor (&gt;50%)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Pattern:</label>
                    <select id="filterPattern">
                        <option value="all">All Patterns</option>
                        <option value="smooth">Smooth</option>
                        <option value="seasonal">Seasonal</option>
                        <option value="erratic">Erratic</option>
                        <option value="intermittent">Intermittent</option>
                        <option value="lumpy">Lumpy</option>
                    </select>
                </div>
                <div class="search-box">
                    <input type="text" placeholder="Search material..." id="searchInput">
                </div>
            </div>

            <!-- Data Table -->
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Material<span class="sap-field">MARA.MATNR</span></th>
                            <th>Plant<span class="sap-field">MARC.WERKS</span></th>
                            <th>Pattern<span class="sap-field">From DI</span></th>
                            <th>Model<span class="sap-field">Auto-Selected</span></th>
                            <th>Fcst 1M<span class="sap-field">P50 (P10-P90)</span></th>
                            <th>Fcst 3M<span class="sap-field">P50 (P10-P90)</span></th>
                            <th>Fcst 6M<span class="sap-field">P50 (P10-P90)</span></th>
                            <th>P10 (Low)<span class="sap-field">10th Pctl</span></th>
                            <th>P90 (High)<span class="sap-field">90th Pctl</span></th>
                            <th>MAPE<span class="sap-field">Backtest</span></th>
                            <th>Bias<span class="sap-field">+Over/-Under</span></th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Data rows will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Detail View -->
        <div class="detail-view" id="detailView">
            <button class="back-btn" onclick="showListView()">
                ‚Üê Back to List
            </button>

            <div class="detail-header">
                <div>
                    <div class="detail-title" id="detailMaterial">MAT-4521-HYD</div>
                    <div class="detail-subtitle" id="detailSubtitle">Hydraulic Actuator | Plant P100 - US East</div>
                </div>
                <div style="text-align: right;">
                    <div class="badge badge-seasonal" id="detailPatternBadge">Seasonal</div>
                    <div style="margin-top: 8px;">
                        <span class="model-badge" id="detailModelBadge">Holt-Winters</span>
                    </div>
                </div>
            </div>

            <div class="detail-grid">
                <!-- Forecast Summary Card -->
                <div class="detail-card">
                    <h3><span class="icon">üîÆ</span> Forecast Summary (Next Month)</h3>
                    <div class="forecast-display">
                        <div class="forecast-main" id="detailFcst1M">340</div>
                        <div class="forecast-range-text" id="detailRange1M">280 - 410</div>
                        <div class="forecast-label">P50 Point Estimate (P10 - P90 Range)</div>
                    </div>
                    <div style="margin-top: 16px;">
                        <div class="metric-row">
                            <span class="metric-label">3-Month Forecast</span>
                            <span class="metric-value" id="detailFcst3M">1,020</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">6-Month Forecast</span>
                            <span class="metric-value" id="detailFcst6M">2,180</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Confidence Width</span>
                            <span class="metric-value" id="detailConfWidth">38%</span>
                        </div>
                    </div>
                </div>

                <!-- Accuracy Metrics Card -->
                <div class="detail-card">
                    <h3><span class="icon">üéØ</span> Accuracy Metrics</h3>
                    <div class="metric-row">
                        <span class="metric-label">MAPE<span class="sap-ref">Mean Abs % Error</span></span>
                        <span class="metric-value" id="detailMAPE" style="color: var(--amber);">22%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">MAE<span class="sap-ref">Mean Abs Error</span></span>
                        <span class="metric-value" id="detailMAE">94 EA</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">RMSE<span class="sap-ref">Root Mean Sq Error</span></span>
                        <span class="metric-value" id="detailRMSE">112</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Bias<span class="sap-ref">Systematic Error</span></span>
                        <span class="metric-value" id="detailBias" style="color: var(--amber);">+5%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Tracking Signal<span class="sap-ref">Cumulative/MAE</span></span>
                        <span class="metric-value" id="detailTS">1.2</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">R¬≤ (Model Fit)<span class="sap-ref">Explained Variance</span></span>
                        <span class="metric-value" id="detailR2">0.72</span>
                    </div>
                </div>

                <!-- Model Selection Card -->
                <div class="detail-card">
                    <h3><span class="icon">üß†</span> Model Selection</h3>
                    <div class="metric-row">
                        <span class="metric-label">Pattern (from DI)<span class="sap-ref">Demand Intelligence</span></span>
                        <span class="metric-value" id="detailPattern">Seasonal</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Selected Model<span class="sap-ref">Best MAPE</span></span>
                        <span class="metric-value" id="detailModel">Holt-Winters (Add)</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Backtest Periods<span class="sap-ref">Holdout</span></span>
                        <span class="metric-value">6 months</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Œ± (Level)<span class="sap-ref">Smoothing</span></span>
                        <span class="metric-value" id="detailAlpha">0.35</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Œ≤ (Trend)<span class="sap-ref">Smoothing</span></span>
                        <span class="metric-value" id="detailBeta">0.12</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Œ≥ (Season)<span class="sap-ref">Smoothing</span></span>
                        <span class="metric-value" id="detailGamma">0.28</span>
                    </div>
                </div>
            </div>

            <!-- Model Comparison -->
            <div class="detail-card" style="margin-bottom: 20px;">
                <h3><span class="icon">‚öñÔ∏è</span> Model Comparison (Backtest Results)</h3>
                <div class="model-comparison" id="modelComparison">
                    <!-- Will be populated by JS -->
                </div>
            </div>

            <!-- Forecast vs Actual Chart -->
            <div class="detail-card" style="margin-bottom: 20px;">
                <h3><span class="icon">üìä</span> Forecast vs Actual (Last 12 Months + 3 Months Ahead)</h3>
                <div class="forecast-chart">
                    <div class="chart-area" id="forecastChart">
                        <!-- Will be populated by JS -->
                    </div>
                </div>
                <div style="display: flex; justify-content: center; gap: 24px; margin-top: 12px;">
                    <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                        <span style="width: 12px; height: 12px; background: var(--cyan); border-radius: 2px;"></span>
                        Actual
                    </span>
                    <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                        <span style="width: 12px; height: 12px; background: var(--purple); border-radius: 2px;"></span>
                        Forecast (P50)
                    </span>
                    <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                        <span style="width: 12px; height: 12px; background: rgba(139, 92, 246, 0.3); border-radius: 2px; border: 1px dashed var(--purple);"></span>
                        Confidence Band
                    </span>
                </div>
            </div>

            <!-- Navigation to Other Tiles -->
            <div class="nav-cards">
                <div class="nav-card" onclick="alert('Navigate to Demand Intelligence')">
                    <div class="nav-icon">üìä</div>
                    <div class="nav-title">Demand Intelligence</div>
                    <div class="nav-desc">View demand patterns, CV, ADI, and risk scores</div>
                </div>
                <div class="nav-card" onclick="alert('Navigate to Safety Stock Optimizer')">
                    <div class="nav-icon">üõ°Ô∏è</div>
                    <div class="nav-title">Safety Stock Optimizer</div>
                    <div class="nav-desc">Optimize buffer stock using forecast uncertainty</div>
                </div>
                <div class="nav-card" onclick="alert('Navigate to MRP Tuner')">
                    <div class="nav-icon">üéõÔ∏è</div>
                    <div class="nav-title">MRP Parameter Tuner</div>
                    <div class="nav-desc">Fine-tune reorder points and lot sizes</div>
                </div>
                <div class="nav-card" onclick="alert('Navigate to Recommendations')">
                    <div class="nav-icon">üí°</div>
                    <div class="nav-title">Recommendations Hub</div>
                    <div class="nav-desc">View prioritized actions and SAP writeback</div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            STOX.AI Forecasting Engine | Cloud Mantra LLC | Last forecast run: <span id="refreshTime"></span>
        </div>
    </div>

    <script>
        // Sample forecast data
        const forecastData = [
            {
                material: 'MAT-4521-HYD',
                description: 'Hydraulic Actuator',
                plant: 'P100',
                plantName: 'US East',
                pattern: 'Seasonal',
                model: 'Holt-Winters',
                fcst1m: 340, p10_1m: 280, p90_1m: 410,
                fcst3m: 1020, p10_3m: 840, p90_3m: 1200,
                fcst6m: 2180, p10_6m: 1800, p90_6m: 2600,
                mape: 22, bias: 5,
                mae: 94, rmse: 112, ts: 1.2, r2: 0.72,
                params: { alpha: 0.35, beta: 0.12, gamma: 0.28 },
                modelComparison: [
                    { name: 'Holt-Winters (Add)', mape: 22, selected: true },
                    { name: 'Holt-Winters (Mult)', mape: 25, selected: false },
                    { name: 'SARIMA', mape: 28, selected: false }
                ],
                actuals: [320, 280, 410, 290, 350, 380, 420, 310, 280, 450, 890, 720],
                forecasts: [null, null, null, null, null, null, null, null, null, null, null, null, 340, 380, 420]
            },
            {
                material: 'MAT-7892-BRG',
                description: 'Bearing Assembly',
                plant: 'P100',
                plantName: 'US East',
                pattern: 'Smooth',
                model: 'Holt Linear',
                fcst1m: 120, p10_1m: 112, p90_1m: 128,
                fcst3m: 348, p10_3m: 328, p90_3m: 368,
                fcst6m: 666, p10_6m: 626, p90_6m: 706,
                mape: 5, bias: -2,
                mae: 8, rmse: 10, ts: 0.3, r2: 0.98,
                params: { alpha: 0.42, beta: 0.08, gamma: null },
                modelComparison: [
                    { name: 'Holt Linear', mape: 5, selected: true },
                    { name: 'SES', mape: 12, selected: false },
                    { name: 'Damped Trend', mape: 7, selected: false }
                ],
                actuals: [180, 175, 168, 165, 158, 152, 148, 142, 138, 132, 128, 124],
                forecasts: [null, null, null, null, null, null, null, null, null, null, null, null, 120, 116, 112]
            },
            {
                material: 'MAT-3341-ELC',
                description: 'Electronic Controller',
                plant: 'P200',
                plantName: 'US West',
                pattern: 'Erratic',
                model: 'Ensemble',
                fcst1m: 480, p10_1m: 220, p90_1m: 780,
                fcst3m: 1420, p10_3m: 680, p90_3m: 2300,
                fcst6m: 2850, p10_6m: 1400, p90_6m: 4500,
                mape: 42, bias: 8,
                mae: 198, rmse: 245, ts: 2.1, r2: 0.15,
                params: { alpha: 0.5, beta: 0.15, gamma: null },
                modelComparison: [
                    { name: 'Ensemble', mape: 42, selected: true },
                    { name: 'Damped Trend', mape: 48, selected: false },
                    { name: 'Theta', mape: 52, selected: false }
                ],
                actuals: [450, 120, 680, 230, 890, 150, 420, 780, 110, 560, 340, 920],
                forecasts: [null, null, null, null, null, null, null, null, null, null, null, null, 480, 510, 490]
            },
            {
                material: 'MAT-5567-SPR',
                description: 'Spare Part Kit',
                plant: 'P100',
                plantName: 'US East',
                pattern: 'Intermittent',
                model: 'Croston',
                fcst1m: 19, p10_1m: 0, p90_1m: 52,
                fcst3m: 56, p10_3m: 15, p90_3m: 120,
                fcst6m: 112, p10_6m: 35, p90_6m: 220,
                mape: 38, bias: -5,
                mae: 18, rmse: 24, ts: 0.8, r2: 0.42,
                params: { alpha: 0.15, beta: null, gamma: null },
                modelComparison: [
                    { name: 'Croston', mape: 38, selected: true },
                    { name: 'SBA', mape: 42, selected: false },
                    { name: 'TSB', mape: 45, selected: false }
                ],
                actuals: [0, 45, 0, 0, 38, 0, 52, 0, 0, 41, 0, 48],
                forecasts: [null, null, null, null, null, null, null, null, null, null, null, null, 19, 19, 19]
            },
            {
                material: 'MAT-9921-FLT',
                description: 'Filter Assembly',
                plant: 'P300',
                plantName: 'EU',
                pattern: 'Lumpy',
                model: 'Bootstrap',
                fcst1m: 95, p10_1m: 0, p90_1m: 380,
                fcst3m: 285, p10_3m: 50, p90_3m: 850,
                fcst6m: 570, p10_6m: 120, p90_6m: 1500,
                mape: 52, bias: 12,
                mae: 125, rmse: 185, ts: 2.8, r2: 0.28,
                params: { alpha: null, beta: null, gamma: null },
                modelComparison: [
                    { name: 'Bootstrap', mape: 52, selected: true },
                    { name: 'Quantile Reg', mape: 58, selected: false },
                    { name: 'Croston', mape: 65, selected: false }
                ],
                actuals: [0, 280, 0, 150, 0, 0, 420, 0, 0, 180, 650, 0],
                forecasts: [null, null, null, null, null, null, null, null, null, null, null, null, 95, 110, 125]
            }
        ];

        // Render table
        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.onclick = () => showDetail(row);

                const patternClass = `badge-${row.pattern.toLowerCase()}`;
                
                // MAPE indicator
                let mapeIndicator = 'green';
                let mapeColor = 'var(--emerald)';
                if (row.mape > 50) { mapeIndicator = 'red'; mapeColor = 'var(--red)'; }
                else if (row.mape > 30) { mapeIndicator = 'orange'; mapeColor = '#F97316'; }
                else if (row.mape > 15) { mapeIndicator = 'yellow'; mapeColor = 'var(--amber)'; }

                // Bias display
                const biasClass = row.bias > 10 ? 'positive' : row.bias < -10 ? 'negative' : 'neutral';
                const biasSign = row.bias > 0 ? '+' : '';
                const biasWidth = Math.min(Math.abs(row.bias) * 2, 50);

                tr.innerHTML = `
                    <td class="material-cell">${row.material}</td>
                    <td>${row.plant}</td>
                    <td><span class="badge ${patternClass}">${row.pattern}</span></td>
                    <td><span class="model-badge">${row.model}</span></td>
                    <td>
                        <div class="forecast-range">
                            <span class="forecast-point">${row.fcst1m.toLocaleString()}</span>
                            <span class="forecast-interval">(${row.p10_1m.toLocaleString()}-${row.p90_1m.toLocaleString()})</span>
                        </div>
                    </td>
                    <td>
                        <div class="forecast-range">
                            <span class="forecast-point">${row.fcst3m.toLocaleString()}</span>
                            <span class="forecast-interval">(${row.p10_3m.toLocaleString()}-${row.p90_3m.toLocaleString()})</span>
                        </div>
                    </td>
                    <td>
                        <div class="forecast-range">
                            <span class="forecast-point">${row.fcst6m.toLocaleString()}</span>
                            <span class="forecast-interval">(${row.p10_6m.toLocaleString()}-${row.p90_6m.toLocaleString()})</span>
                        </div>
                    </td>
                    <td style="font-family: 'JetBrains Mono', monospace; color: var(--text-secondary);">${row.p10_1m.toLocaleString()}</td>
                    <td style="font-family: 'JetBrains Mono', monospace; color: var(--text-secondary);">${row.p90_1m.toLocaleString()}</td>
                    <td>
                        <div class="mape-gauge">
                            <div class="mape-bar">
                                <div class="mape-bar-fill" style="width: ${Math.min(row.mape, 100)}%; background: ${mapeColor};"></div>
                            </div>
                            <span class="mape-value" style="color: ${mapeColor};">${row.mape}%</span>
                        </div>
                    </td>
                    <td>
                        <div class="bias-display">
                            <div class="bias-bar">
                                <div class="bias-center"></div>
                                <div class="bias-indicator ${row.bias >= 0 ? 'positive' : 'negative'}" 
                                     style="width: ${biasWidth}%;"></div>
                            </div>
                            <span class="bias-value ${biasClass}">${biasSign}${row.bias}%</span>
                        </div>
                    </td>
                `;

                tbody.appendChild(tr);
            });
        }

        // Show detail view
        function showDetail(row) {
            document.getElementById('listView').classList.add('hidden');
            document.getElementById('detailView').classList.add('active');

            // Update header
            document.getElementById('detailMaterial').textContent = row.material;
            document.getElementById('detailSubtitle').textContent = `${row.description} | Plant ${row.plant} - ${row.plantName}`;

            // Update badges
            const patternBadge = document.getElementById('detailPatternBadge');
            patternBadge.textContent = row.pattern;
            patternBadge.className = `badge badge-${row.pattern.toLowerCase()}`;

            document.getElementById('detailModelBadge').textContent = row.model;

            // Forecast summary
            document.getElementById('detailFcst1M').textContent = row.fcst1m.toLocaleString();
            document.getElementById('detailRange1M').textContent = `${row.p10_1m.toLocaleString()} - ${row.p90_1m.toLocaleString()}`;
            document.getElementById('detailFcst3M').textContent = row.fcst3m.toLocaleString();
            document.getElementById('detailFcst6M').textContent = row.fcst6m.toLocaleString();

            const confWidth = Math.round((row.p90_1m - row.p10_1m) / row.fcst1m * 100);
            document.getElementById('detailConfWidth').textContent = `${confWidth}%`;

            // Accuracy metrics
            let mapeColor = 'var(--emerald)';
            if (row.mape > 50) mapeColor = 'var(--red)';
            else if (row.mape > 30) mapeColor = '#F97316';
            else if (row.mape > 15) mapeColor = 'var(--amber)';

            document.getElementById('detailMAPE').textContent = `${row.mape}%`;
            document.getElementById('detailMAPE').style.color = mapeColor;
            document.getElementById('detailMAE').textContent = `${row.mae} EA`;
            document.getElementById('detailRMSE').textContent = row.rmse;

            const biasSign = row.bias > 0 ? '+' : '';
            const biasColor = row.bias > 10 ? 'var(--amber)' : row.bias < -10 ? 'var(--cyan)' : 'var(--text-secondary)';
            document.getElementById('detailBias').textContent = `${biasSign}${row.bias}%`;
            document.getElementById('detailBias').style.color = biasColor;

            document.getElementById('detailTS').textContent = row.ts.toFixed(1);
            document.getElementById('detailR2').textContent = row.r2.toFixed(2);

            // Model selection
            document.getElementById('detailPattern').textContent = row.pattern;
            document.getElementById('detailModel').textContent = row.model;
            document.getElementById('detailAlpha').textContent = row.params.alpha ? row.params.alpha.toFixed(2) : 'N/A';
            document.getElementById('detailBeta').textContent = row.params.beta ? row.params.beta.toFixed(2) : 'N/A';
            document.getElementById('detailGamma').textContent = row.params.gamma ? row.params.gamma.toFixed(2) : 'N/A';

            // Model comparison
            const modelComp = document.getElementById('modelComparison');
            modelComp.innerHTML = '';
            row.modelComparison.forEach(m => {
                const div = document.createElement('div');
                div.className = `model-option ${m.selected ? 'selected' : ''}`;
                div.innerHTML = `
                    <div class="model-name">${m.name}</div>
                    <div class="model-mape">MAPE: ${m.mape}%</div>
                `;
                modelComp.appendChild(div);
            });

            // Forecast chart
            renderForecastChart(row);
        }

        function renderForecastChart(row) {
            const chart = document.getElementById('forecastChart');
            chart.innerHTML = '';

            const allValues = [...row.actuals, ...row.forecasts.filter(v => v !== null)];
            const maxValue = Math.max(...allValues);
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'F1', 'F2', 'F3'];

            for (let i = 0; i < 15; i++) {
                const group = document.createElement('div');
                group.className = 'chart-bar-group';

                if (i < 12 && row.actuals[i] !== undefined) {
                    const bar = document.createElement('div');
                    bar.className = 'chart-bar actual';
                    bar.style.height = `${(row.actuals[i] / maxValue) * 140}px`;
                    bar.title = `${months[i]}: ${row.actuals[i]} EA (Actual)`;
                    group.appendChild(bar);
                } else if (i >= 12 && row.forecasts[i] !== null) {
                    const container = document.createElement('div');
                    container.style.position = 'relative';
                    container.style.width = '100%';
                    container.style.height = `${(row.p90_1m / maxValue) * 140}px`;

                    // Confidence band
                    const confBand = document.createElement('div');
                    confBand.style.position = 'absolute';
                    confBand.style.bottom = '0';
                    confBand.style.width = '100%';
                    confBand.style.height = `${((row.p90_1m - row.p10_1m) / maxValue) * 140}px`;
                    confBand.style.background = 'rgba(139, 92, 246, 0.2)';
                    confBand.style.borderRadius = '4px';
                    confBand.style.border = '1px dashed var(--purple)';
                    confBand.style.marginBottom = `${(row.p10_1m / maxValue) * 140}px`;
                    container.appendChild(confBand);

                    // Point forecast
                    const bar = document.createElement('div');
                    bar.className = 'chart-bar forecast';
                    bar.style.height = `${(row.forecasts[i] / maxValue) * 140}px`;
                    bar.style.position = 'absolute';
                    bar.style.bottom = '0';
                    bar.style.width = '100%';
                    bar.title = `${months[i]}: ${row.forecasts[i]} EA (Forecast)`;
                    container.appendChild(bar);

                    group.appendChild(container);
                }

                const label = document.createElement('div');
                label.className = 'chart-label';
                label.textContent = months[i];
                group.appendChild(label);

                chart.appendChild(group);
            }
        }

        // Show list view
        function showListView() {
            document.getElementById('listView').classList.remove('hidden');
            document.getElementById('detailView').classList.remove('active');
        }

        // Initialize
        document.getElementById('refreshTime').textContent = new Date().toLocaleString();
        renderTable(forecastData);

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = forecastData.filter(row => 
                row.material.toLowerCase().includes(term) ||
                row.description.toLowerCase().includes(term)
            );
            renderTable(filtered);
        });

        // Filter functionality
        ['filterPlant', 'filterModel', 'filterAccuracy', 'filterPattern'].forEach(id => {
            document.getElementById(id).addEventListener('change', applyFilters);
        });

        function applyFilters() {
            let filtered = [...forecastData];

            const plant = document.getElementById('filterPlant').value;
            const model = document.getElementById('filterModel').value;
            const accuracy = document.getElementById('filterAccuracy').value;
            const pattern = document.getElementById('filterPattern').value;

            if (plant !== 'all') filtered = filtered.filter(r => r.plant === plant);
            if (model !== 'all') filtered = filtered.filter(r => r.model === model);
            if (pattern !== 'all') filtered = filtered.filter(r => r.pattern.toLowerCase() === pattern);
            
            if (accuracy === 'excellent') filtered = filtered.filter(r => r.mape < 15);
            if (accuracy === 'good') filtered = filtered.filter(r => r.mape >= 15 && r.mape < 30);
            if (accuracy === 'fair') filtered = filtered.filter(r => r.mape >= 30 && r.mape < 50);
            if (accuracy === 'poor') filtered = filtered.filter(r => r.mape >= 50);

            renderTable(filtered);
        }
    </script>
</body>
</html>
