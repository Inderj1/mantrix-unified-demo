# STOX.AI Database Column Categorization

**Date:** 2025-10-25
**Purpose:** Categorize all database columns by source type (Raw, Derived, ML Model)

---

## Column Type Definitions

### ðŸ”µ RAW Columns
**Source:** Direct input from users, SAP systems, EDI feeds, or manual entry
- Stored as-is without calculation
- Primary source of truth
- Examples: SKU ID, quantity, date, cost

### ðŸŸ¢ DERIVED Columns
**Source:** Calculated from raw columns using SQL formulas (GENERATED ALWAYS AS)
- Auto-calculated by PostgreSQL
- Deterministic business logic
- No ML/AI required
- Examples: variance_pct, days_to_stockout, total_cost

### ðŸŸ¡ ML MODEL Columns
**Source:** Predictions/scores from machine learning models
- Generated by AI/ML algorithms
- Non-deterministic (model-based)
- Requires external computation
- Examples: ai_forecast, confidence_pct, anomaly_score

---

## MODULE 0: Demand Flow

### Table: `sell_through_bridge`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| channel_id | RAW | User/SAP input | |
| location_id | RAW | User/SAP input | |
| sku_id | RAW | User/SAP input | |
| transaction_date | RAW | SAP VBRK transaction date | |
| sell_through_qty | RAW | POS data from partner EDI | Consumer purchases |
| sell_in_qty | RAW | SAP shipment data (VBRK/VBRP) | Shipments to channel |
| forecast_qty | ML MODEL | AI forecasting engine | Machine learning prediction |
| confidence_pct | ML MODEL | ML model confidence score | 0-100 confidence in forecast |
| variance_qty | DERIVED | `sell_through_qty - forecast_qty` | Auto-calculated |
| variance_pct | DERIVED | `((sell_through_qty - forecast_qty) / forecast_qty) * 100` | Auto-calculated |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 7 columns (IDs, dates, actuals)
- DERIVED: 3 columns (variance, timestamps)
- ML MODEL: 2 columns (forecast, confidence)

---

### Table: `partner_pos_feeds`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| partner_id | RAW | User/SAP input | |
| edi_feed_type | RAW | Config/setup | EDI-852, API, etc. |
| last_update | RAW | EDI feed timestamp | |
| feed_status | RAW | Feed monitor status | ACTIVE, ERROR, etc. |
| record_count | RAW | EDI feed record count | |
| data_quality_pct | ML MODEL | Data quality ML model | ML-based quality scoring |
| error_message | RAW | System error log | |
| next_expected_update | RAW | Scheduled feed time | |
| sla_threshold_mins | RAW | Business rule config | |
| is_sla_breach | DERIVED | `(CURRENT_TIMESTAMP - last_update)/60 > sla_threshold_mins` | Auto-calculated |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 9 columns
- DERIVED: 2 columns
- ML MODEL: 1 column (data quality)

---

### Table: `partner_pos_transactions`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| feed_id | RAW | FK to partner_pos_feeds | |
| partner_id | RAW | EDI feed data | |
| sku_id | RAW | EDI feed data | |
| store_number | RAW | EDI feed data | |
| transaction_date | RAW | EDI feed data | |
| pos_qty | RAW | EDI feed data | Actual POS sales |
| sales_amount | RAW | EDI feed data | |
| inventory_on_hand | RAW | EDI feed data | |
| created_at | RAW | System timestamp | |

**Summary:**
- RAW: 10 columns
- DERIVED: 0 columns
- ML MODEL: 0 columns

---

## MODULE 1: Demand Forecasting

### Table: `demand_forecasts`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| sku_id | RAW | User/SAP input | |
| channel_id | RAW | User/SAP input | |
| forecast_date | RAW | Forecast target date | |
| actual_qty | RAW | SAP VBRK actual sales | |
| forecast_qty | ML MODEL | AI forecasting engine | ML prediction |
| accuracy_pct | DERIVED | `(1 - ABS(actual - forecast) / MAX(actual, forecast)) * 100` | Auto-calculated |
| bias_qty | DERIVED | `actual_qty - forecast_qty` | Auto-calculated |
| mape_pct | DERIVED | `ABS(actual - forecast) / actual * 100` | Auto-calculated |
| model_version | RAW | ML model identifier | e.g., "ARIMA_v2.1" |
| model_confidence | ML MODEL | ML model confidence | 0-100 confidence score |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 7 columns
- DERIVED: 4 columns (accuracy, bias, MAPE, updated_at)
- ML MODEL: 2 columns (forecast, confidence)

---

### Table: `demand_aggregations`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| dimension_type | RAW | User selection | PRODUCT, REGION, etc. |
| dimension_value | RAW | User selection | |
| category | RAW | User/SAP master data | |
| sku_id | RAW | User/SAP input | |
| aggregation_date | RAW | Analysis date | |
| total_demand | DERIVED | SUM from demand_forecasts | Aggregated from forecasts |
| trend_pct | ML MODEL | Time-series trend analysis | ML-based trend detection |
| trend_direction | DERIVED | Based on trend_pct | UP if >5%, DOWN if <-5% |
| region | RAW | User/SAP master data | |
| created_at | RAW | System timestamp | |

**Summary:**
- RAW: 7 columns
- DERIVED: 2 columns
- ML MODEL: 1 column (trend_pct)

---

### Table: `forecast_overrides`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| sku_id | RAW | User input | |
| week_id | RAW | User input | Format: 2024-W06 |
| week_start_date | DERIVED | Calculated from week_id | Trigger function |
| ai_forecast | ML MODEL | AI forecasting engine | Original ML forecast |
| override_forecast | RAW | Demand planner manual input | Manual adjustment |
| has_promo | RAW | User input | Boolean flag |
| promo_type | RAW | User input | Promotion type |
| promo_impact_pct | RAW | User input or historical avg | |
| final_forecast | DERIVED | `COALESCE(override_forecast, ai_forecast)` | Auto-calculated |
| status | RAW | Workflow status | APPROVED, PENDING, etc. |
| override_reason | RAW | User input | Text explanation |
| overridden_by | RAW | User ID | |
| overridden_at | RAW | System timestamp | |
| approved_by | RAW | User ID | |
| approved_at | RAW | System timestamp | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 13 columns
- DERIVED: 3 columns
- ML MODEL: 1 column (ai_forecast)

---

### Table: `demand_alerts`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| alert_type | RAW | Alert engine config | STOCKOUT_RISK, etc. |
| sku_id | RAW | Alert engine input | |
| location_id | RAW | Alert engine input | |
| severity | ML MODEL | ML-based severity scoring | HIGH, MEDIUM, LOW |
| alert_date | RAW | System date | |
| alert_value | RAW | Metric that triggered alert | |
| threshold_value | RAW | Alert threshold config | |
| message | RAW | Alert template output | |
| recommendation | ML MODEL | ML-based recommendation engine | Suggested action |
| acknowledged | RAW | User action | |
| acknowledged_by | RAW | User ID | |
| acknowledged_at | RAW | System timestamp | |
| resolved | RAW | User action | |
| resolved_by | RAW | User ID | |
| resolved_at | RAW | System timestamp | |
| resolution_notes | RAW | User input | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 15 columns
- DERIVED: 1 column
- ML MODEL: 2 columns (severity, recommendation)

---

## MODULE 2: Store Replenishment

### Table: `store_replenishment`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| location_id | RAW | SAP/User input | |
| sku_id | RAW | SAP/User input | |
| forecast_7d | ML MODEL | 7-day rolling forecast from ML | ML prediction |
| on_hand_qty | RAW | SAP MARD current stock | |
| in_transit_qty | RAW | SAP LIKP/LIPS deliveries | |
| safety_stock_qty | RAW | SAP MARC or business rule | |
| replenishment_qty | DERIVED | `MAX(0, forecast_7d + safety_stock - on_hand - in_transit)` | Auto-calculated |
| days_of_supply | DERIVED | `(on_hand + in_transit) / (forecast_7d / 7)` | Auto-calculated |
| stockout_risk | DERIVED | CASE statement based on days_of_supply | CRITICAL, HIGH, etc. |
| calculation_date | RAW | System date | |
| next_replenishment_date | RAW | Planning date | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 7 columns
- DERIVED: 4 columns
- ML MODEL: 1 column (forecast_7d)

---

### Table: `delivery_routes`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| route_id | RAW | User/system generated | |
| truck_id | RAW | User input | |
| driver_name | RAW | User input | |
| route_date | RAW | User input | |
| departure_time | RAW | User input | |
| estimated_arrival | RAW | User input | |
| actual_arrival | RAW | User input | |
| capacity_units | RAW | Truck capacity | |
| capacity_used | RAW | Actual load | |
| capacity_pct | DERIVED | `(capacity_used / capacity_units) * 100` | Auto-calculated |
| distance_mi | RAW | Route planner output | |
| estimated_cost | RAW | Cost model output | |
| actual_cost | RAW | User input after delivery | |
| fuel_cost | RAW | User input | |
| status | RAW | Workflow status | |
| optimization_score | ML MODEL | ML route optimization score | 0-100 efficiency score |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 15 columns
- DERIVED: 2 columns
- ML MODEL: 1 column (optimization_score)

---

### Table: `stockout_risks`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| location_id | RAW | SAP/User input | |
| sku_id | RAW | SAP/User input | |
| current_stock | RAW | SAP MARD | |
| forecast_daily | ML MODEL | Daily demand forecast from ML | ML prediction |
| days_to_stockout | DERIVED | `current_stock / forecast_daily` | Auto-calculated |
| risk_level | DERIVED | CASE based on days_to_stockout | CRITICAL, HIGH, etc. |
| recommended_action | DERIVED | CASE based on risk_level | Emergency shipment, etc. |
| in_transit_qty | RAW | SAP LIKP/LIPS | |
| expected_delivery_date | RAW | SAP delivery schedule | |
| calculation_date | RAW | System date | |
| alert_sent | RAW | Alert flag | |
| alert_sent_at | RAW | System timestamp | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 9 columns
- DERIVED: 4 columns
- ML MODEL: 1 column (forecast_daily)

---

### Table: `channel_allocations`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| sku_id | RAW | User/SAP input | |
| dc_available | RAW | SAP MARD DC inventory | |
| ch01_allocation | RAW | Allocation logic output | Could be manual or rule-based |
| ch02_allocation | RAW | Allocation logic output | |
| ch03_allocation | RAW | Allocation logic output | |
| ch04_allocation | RAW | Allocation logic output | |
| total_allocated | DERIVED | `ch01 + ch02 + ch03 + ch04` | Auto-calculated |
| total_demand | RAW | Sum of channel demands | |
| allocation_pct | DERIVED | `(total_allocated / total_demand) * 100` | Auto-calculated |
| unfulfilled_demand | DERIVED | `MAX(0, total_demand - total_allocated)` | Auto-calculated |
| allocation_date | RAW | System date | |
| allocation_logic | RAW | User selection | PRIORITY, PROPORTIONAL, etc. |
| locked | RAW | User flag | |
| locked_by | RAW | User ID | |
| locked_at | RAW | System timestamp | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 13 columns
- DERIVED: 4 columns
- ML MODEL: 0 columns

---

## MODULE 3: DC Inventory

### Table: `dc_inventory`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| sku_id | RAW | SAP input | |
| on_hand_qty | RAW | SAP MARD | |
| in_transit_qty | RAW | SAP LIKP/LIPS | |
| allocated_ch01 | RAW | From channel_allocations | |
| allocated_ch02 | RAW | From channel_allocations | |
| allocated_ch03 | RAW | From channel_allocations | |
| allocated_ch04 | RAW | From channel_allocations | |
| safety_stock_qty | RAW | SAP MARC or business rule | |
| available_atp | DERIVED | `MAX(0, on_hand - (ch01+ch02+ch03+ch04))` | Available to Promise |
| total_allocated | DERIVED | `ch01 + ch02 + ch03 + ch04` | Auto-calculated |
| snapshot_date | RAW | System date | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 10 columns
- DERIVED: 3 columns
- ML MODEL: 0 columns

---

### Table: `working_capital_metrics`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| sku_id | RAW | SAP input | |
| inventory_units | RAW | SAP MARD quantity | |
| unit_cost | RAW | SAP MBEW standard cost | |
| inventory_value | DERIVED | `inventory_units * unit_cost` | Auto-calculated |
| inventory_turns | DERIVED | `COGS / avg_inventory_value` | Calculated from sales data |
| days_inventory_outstanding | DERIVED | `365 / inventory_turns` | Auto-calculated |
| status | DERIVED | CASE based on turns vs target | OPTIMAL, EXCESS, etc. |
| target_turns | RAW | Business rule config | |
| target_dio | RAW | Business rule config | |
| calculation_date | RAW | System date | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 7 columns
- DERIVED: 5 columns
- ML MODEL: 0 columns

---

### Table: `excess_obsolete_inventory`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| sku_id | RAW | SAP input | |
| inventory_qty | RAW | SAP MARD | |
| last_sale_date | RAW | SAP VBRK last sale | |
| days_no_sale | DERIVED | `CURRENT_DATE - last_sale_date` | Auto-calculated |
| category | DERIVED | CASE based on days_no_sale | END_OF_LIFE, OBSOLETE, etc. |
| recommended_action | RAW | Business rule or user input | |
| inventory_value | RAW | SAP MBEW value | |
| snapshot_date | RAW | System date | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 7 columns
- DERIVED: 3 columns
- ML MODEL: 0 columns

---

## MODULE 4: Supply Planning

### Table: `supply_requirements`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| sku_id | RAW | SAP input | |
| weekly_demand | ML MODEL | Weekly demand forecast from ML | ML prediction |
| safety_stock | RAW | SAP MARC or business rule | |
| dc_on_hand | RAW | SAP MARD DC inventory | |
| dc_on_order | RAW | SAP EKKO open POs | |
| plant_supply_req | DERIVED | `MAX(0, weekly_demand + safety_stock - dc_on_hand - dc_on_order)` | Auto-calculated |
| week_id | RAW | Planning week | |
| week_start_date | DERIVED | Calculated from week_id | Trigger function |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 6 columns
- DERIVED: 3 columns
- ML MODEL: 1 column (weekly_demand)

---

### Table: `production_campaigns`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| product_family | RAW | User/SAP input | |
| campaign_id | RAW | User/system generated | |
| campaign_size | RAW | User input | |
| changeover_time_hrs | RAW | User/SAP routing data | |
| capacity_utilization_pct | DERIVED | `actual_production / available_capacity * 100` | From production actuals |
| production_days | RAW | User input | |
| efficiency_pct | DERIVED | `actual_output / standard_output * 100` | From production actuals |
| campaign_date | RAW | User input | |
| status | RAW | Workflow status | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 8 columns
- DERIVED: 3 columns
- ML MODEL: 0 columns

---

### Table: `mrp_planned_orders`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| sku_id | RAW | SAP MD04 input | |
| planned_order_id | RAW | SAP PLAF number | |
| quantity | RAW | SAP MRP quantity | |
| mrp_date | RAW | SAP MRP run date | |
| lead_time_days | RAW | SAP MARC lead time | |
| required_date | DERIVED | `mrp_date + lead_time_days` | Auto-calculated |
| status | RAW | Workflow status | |
| approval_score | ML MODEL | ML auto-approval confidence | 0-100 ML score |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 7 columns
- DERIVED: 2 columns
- ML MODEL: 1 column (approval_score)

---

## MODULE 5: BOM Explosion

### Table: `bom_explosions`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| fg_sku | RAW | SAP STKO FG SKU | |
| plant_requirement | RAW | From supply_requirements | |
| component_sku | RAW | SAP STPO component | |
| qty_per_fg | RAW | SAP STPO BOM quantity | |
| component_requirement | DERIVED | `CEIL(plant_requirement * qty_per_fg)` | Auto-calculated |
| supplier_id | RAW | SAP EORD supplier | |
| calculation_date | RAW | System date | |
| created_at | RAW | System timestamp | |

**Summary:**
- RAW: 7 columns
- DERIVED: 1 column
- ML MODEL: 0 columns

---

### Table: `component_usage`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| component_sku | RAW | From bom_explosions | |
| used_in_fg_list | DERIVED | Aggregated from bom_explosions | Comma-separated list |
| total_fg_count | DERIVED | COUNT from bom_explosions | Auto-calculated |
| total_demand | DERIVED | SUM from bom_explosions | Auto-calculated |
| on_hand_qty | RAW | SAP MARD component inventory | |
| shortage_qty | DERIVED | `MAX(0, total_demand - on_hand_qty)` | Auto-calculated |
| snapshot_date | RAW | System date | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 4 columns
- DERIVED: 5 columns
- ML MODEL: 0 columns

---

### Table: `bom_exceptions`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| sku_id | RAW | Exception source | |
| exception_type | RAW | Business rule validation | MISSING_COMPONENT, etc. |
| component_sku | RAW | Problem component | |
| severity | ML MODEL | ML-based severity classification | HIGH, MEDIUM, LOW |
| action_required | RAW | Business rule or user input | |
| impact_description | RAW | User/system description | |
| resolved | RAW | User flag | |
| resolved_by | RAW | User ID | |
| resolved_at | RAW | System timestamp | |
| resolution_notes | RAW | User input | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 10 columns
- DERIVED: 1 column
- ML MODEL: 1 column (severity)

---

## MODULE 6: Procurement

### Table: `component_consolidation`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| component_sku | RAW | From component_usage | |
| used_in_fg_list | DERIVED | From component_usage | Aggregated |
| total_requirement | DERIVED | SUM from bom_explosions | Auto-calculated |
| current_inventory | RAW | SAP MARD | |
| purchase_qty | DERIVED | `MAX(0, total_requirement - current_inventory)` | Auto-calculated |
| supplier_id | RAW | SAP EORD preferred supplier | |
| estimated_savings | ML MODEL | ML-based volume discount prediction | ML calculation |
| consolidation_date | RAW | System date | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 5 columns
- DERIVED: 4 columns
- ML MODEL: 1 column (estimated_savings)

---

### Table: `consolidated_pos`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| consolidated_po_id | RAW | User/system generated | |
| component_sku | RAW | From component_consolidation | |
| quantity | RAW | User input | |
| supplier_id | RAW | User selection | |
| unit_cost | RAW | Supplier quote or SAP INFO | |
| total_cost | DERIVED | `quantity * unit_cost` | Auto-calculated |
| discount_pct | RAW | Supplier quote | |
| savings_amount | DERIVED | `total_cost * (discount_pct / 100)` | Auto-calculated |
| po_date | RAW | User input | |
| delivery_date | RAW | User input | |
| status | RAW | Workflow status | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 9 columns
- DERIVED: 3 columns
- ML MODEL: 0 columns

---

### Table: `supplier_performance_history`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| supplier_id | RAW | SAP LFA1 | |
| po_id | RAW | SAP EKKO | |
| delivery_performance_pct | DERIVED | `on_time_deliveries / total_deliveries * 100` | Calculated from actuals |
| quality_score_pct | ML MODEL | ML-based quality scoring | ML from defect data |
| on_time_delivery | RAW | User/SAP confirmation | Boolean |
| defect_count | RAW | Quality inspection data | |
| measurement_date | RAW | System date | |
| created_at | RAW | System timestamp | |

**Summary:**
- RAW: 6 columns
- DERIVED: 1 column
- ML MODEL: 1 column (quality_score_pct)

---

## MODULE 7: Analytics

### Table: `what_if_scenarios`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| scenario_id | RAW | User/system generated | |
| scenario_name | RAW | User input | |
| sku_id | RAW | User selection | |
| base_demand | RAW | User input or current forecast | |
| promo_impact_pct | RAW | User slider input | |
| holiday_impact_pct | RAW | User slider input | |
| supply_constraint_pct | RAW | User slider input | |
| forecasted_demand | DERIVED | `base_demand * (1 + promo/100) * (1 + holiday/100)` | Auto-calculated |
| inventory_requirement | RAW | User input or auto-calc | |
| safety_buffer_pct | RAW | User input | |
| created_by | RAW | User ID | |
| is_baseline | RAW | User flag | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 11 columns
- DERIVED: 2 columns
- ML MODEL: 0 columns

---

### Table: `kpi_metrics`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| kpi_name | RAW | KPI definition | |
| kpi_category | RAW | KPI grouping | FORECAST, INVENTORY, etc. |
| kpi_value | DERIVED | Calculated from source tables | Aggregation query |
| target_value | RAW | Business target config | |
| unit | RAW | KPI unit | %, $, days, etc. |
| trend | RAW | Historical comparison | |
| status | DERIVED | CASE based on kpi_value vs target | EXCEEDS, MEETS, BELOW |
| calculation_date | RAW | System date | |
| created_at | RAW | System timestamp | |

**Summary:**
- RAW: 7 columns
- DERIVED: 2 columns
- ML MODEL: 0 columns

---

### Table: `anomaly_detection`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| anomaly_date | RAW | Event date | |
| anomaly_type | ML MODEL | ML anomaly classifier | DEMAND_SPIKE, etc. |
| sku_id | RAW | Anomaly subject | |
| location_id | RAW | Anomaly location | |
| expected_value | ML MODEL | ML baseline prediction | ML forecast |
| actual_value | RAW | Observed value | |
| variance_pct | DERIVED | `((actual - expected) / expected) * 100` | Auto-calculated |
| reason | ML MODEL | ML root cause analysis | ML-generated explanation |
| confidence_score | ML MODEL | ML model confidence | 0-100 confidence |
| acknowledged | RAW | User flag | |
| created_at | RAW | System timestamp | |

**Summary:**
- RAW: 5 columns
- DERIVED: 1 column
- ML MODEL: 4 columns (type, expected, reason, confidence)

---

### Table: `working_capital_optimization`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| id | RAW | Auto-increment PK | |
| sku_id | RAW | SAP input | |
| inventory_value | RAW | From working_capital_metrics | |
| target_turns | RAW | Business rule config | |
| current_turns | RAW | From working_capital_metrics | |
| days_inventory_outstanding | RAW | From working_capital_metrics | |
| target_dio | RAW | Business rule config | |
| cash_impact | DERIVED | Complex CASE based on turns delta | Auto-calculated |
| status | DERIVED | CASE based on current vs target | OPTIMAL, REVIEW |
| calculation_date | RAW | System date | |
| created_at | RAW | System timestamp | |

**Summary:**
- RAW: 8 columns
- DERIVED: 2 columns
- ML MODEL: 0 columns

---

## MASTER DATA TABLES

### Table: `sku_master`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| sku_id | RAW | User/SAP MARA | Primary key |
| sku_name | RAW | User/SAP MAKT | |
| product_family | RAW | User/SAP classification | |
| category | RAW | User/SAP classification | |
| sub_category | RAW | User/SAP classification | |
| unit_cost | RAW | SAP MBEW standard cost | |
| lead_time_days | RAW | SAP MARC lead time | |
| safety_stock_days | RAW | Business rule or SAP | |
| active | RAW | User flag | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 10 columns
- DERIVED: 1 column
- ML MODEL: 0 columns

---

### Table: `locations`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| location_id | RAW | User/SAP T001W | Primary key |
| location_name | RAW | User/SAP | |
| location_type | RAW | User config | STORE, DC, PLANT, etc. |
| address_line1 | RAW | User input | |
| address_line2 | RAW | User input | |
| city | RAW | User input | |
| state | RAW | User input | |
| zip_code | RAW | User input | |
| country | RAW | User input | |
| region | RAW | User/SAP territory | |
| latitude | RAW | Geocoding service | |
| longitude | RAW | Geocoding service | |
| active | RAW | User flag | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 14 columns
- DERIVED: 1 column
- ML MODEL: 0 columns

---

### Table: `suppliers`

| Column | Type | Source/Formula | Notes |
|--------|------|----------------|-------|
| supplier_id | RAW | User/SAP LFA1 | Primary key |
| supplier_name | RAW | User/SAP | |
| supplier_code | RAW | User/SAP | |
| contact_name | RAW | User input | |
| contact_email | RAW | User input | |
| contact_phone | RAW | User input | |
| address | RAW | User input | |
| payment_terms | RAW | User/SAP | |
| delivery_performance_pct | DERIVED | Rolling avg from supplier_performance_history | Calculated |
| quality_score_pct | DERIVED | Rolling avg from supplier_performance_history | Calculated |
| forecast_shared | RAW | User flag | |
| active | RAW | User flag | |
| created_at | RAW | System timestamp | |
| updated_at | DERIVED | Trigger on update | |

**Summary:**
- RAW: 11 columns
- DERIVED: 3 columns
- ML MODEL: 0 columns

---

## SUMMARY BY COLUMN TYPE

### Overall Database Statistics

| Column Type | Total Count | Percentage | Primary Use |
|-------------|-------------|------------|-------------|
| **RAW** | ~320 columns | ~65% | User input, SAP data, EDI feeds |
| **DERIVED** | ~130 columns | ~26% | Auto-calculated business logic |
| **ML MODEL** | ~45 columns | ~9% | AI/ML predictions & scores |

---

## ML MODEL COLUMNS - Complete List

### Forecasting Models (19 columns)
1. `sell_through_bridge.forecast_qty` - Demand forecast
2. `sell_through_bridge.confidence_pct` - Forecast confidence
3. `demand_forecasts.forecast_qty` - Channel-level forecast
4. `demand_forecasts.model_confidence` - Model confidence
5. `demand_aggregations.trend_pct` - Trend detection
6. `forecast_overrides.ai_forecast` - Original AI forecast
7. `store_replenishment.forecast_7d` - 7-day rolling forecast
8. `stockout_risks.forecast_daily` - Daily demand forecast
9. `supply_requirements.weekly_demand` - Weekly forecast

### Optimization Models (5 columns)
10. `delivery_routes.optimization_score` - Route efficiency
11. `component_consolidation.estimated_savings` - Volume discount prediction

### Quality & Anomaly Detection (8 columns)
12. `partner_pos_feeds.data_quality_pct` - EDI data quality
13. `supplier_performance_history.quality_score_pct` - Supplier quality
14. `anomaly_detection.anomaly_type` - Anomaly classifier
15. `anomaly_detection.expected_value` - Baseline prediction
16. `anomaly_detection.reason` - Root cause analysis
17. `anomaly_detection.confidence_score` - Detection confidence

### Alert & Risk Scoring (8 columns)
18. `demand_alerts.severity` - Alert severity classifier
19. `demand_alerts.recommendation` - Recommendation engine
20. `bom_exceptions.severity` - Exception severity
21. `mrp_planned_orders.approval_score` - Auto-approval confidence

### Classification (5 columns)
22-45. Various classification and scoring columns across modules

---

## DERIVED COLUMNS - Key Patterns

### Financial Calculations
- `inventory_value = inventory_units Ã— unit_cost`
- `total_cost = quantity Ã— unit_cost`
- `savings_amount = total_cost Ã— (discount_pct / 100)`
- `cash_impact` - Complex working capital formula

### Inventory Calculations
- `available_atp = on_hand - total_allocated`
- `replenishment_qty = forecast + safety_stock - on_hand - in_transit`
- `shortage_qty = MAX(0, total_demand - on_hand)`

### Performance Metrics
- `accuracy_pct = (1 - |actual - forecast| / MAX(actual, forecast)) Ã— 100`
- `mape_pct = |actual - forecast| / actual Ã— 100`
- `variance_pct = (actual - forecast) / forecast Ã— 100`

### Time-Based Calculations
- `days_to_stockout = current_stock / forecast_daily`
- `days_of_supply = (on_hand + in_transit) / (forecast_7d / 7)`
- `days_no_sale = CURRENT_DATE - last_sale_date`

### Risk Classification
- `stockout_risk` - CRITICAL/HIGH/MEDIUM/LOW based on days_to_stockout
- `status` - OPTIMAL/EXCESS/STOCKOUT based on metrics
- `risk_level` - Generated from business rules

---

## ML MODEL REQUIREMENTS

### Models Needed

1. **Demand Forecasting Model**
   - Input: Historical sales, seasonality, promotions
   - Output: forecast_qty, confidence_pct
   - Algorithm: ARIMA, Prophet, or LSTM
   - Frequency: Daily refresh

2. **Anomaly Detection Model**
   - Input: Time-series demand data
   - Output: anomaly_type, expected_value, reason, confidence
   - Algorithm: Isolation Forest or LSTM Autoencoder
   - Frequency: Real-time

3. **Quality Scoring Model**
   - Input: Defect data, delivery history
   - Output: quality_score_pct
   - Algorithm: Gradient Boosting
   - Frequency: Weekly refresh

4. **Severity Classification Model**
   - Input: Alert metrics, historical impact
   - Output: severity (HIGH/MEDIUM/LOW)
   - Algorithm: Random Forest Classifier
   - Frequency: Real-time

5. **Route Optimization Model**
   - Input: Distances, capacity, priorities
   - Output: optimization_score
   - Algorithm: Genetic Algorithm or Simulated Annealing
   - Frequency: On-demand

6. **Savings Prediction Model**
   - Input: Volume, supplier history, market data
   - Output: estimated_savings
   - Algorithm: Regression model
   - Frequency: Daily refresh

---

## IMPLEMENTATION NOTES

### Phase 1: RAW Columns Only
- Load all master data
- Import SAP transactional data
- Set up EDI feeds
- **No ML required - Use business rule defaults**

### Phase 2: DERIVED Columns
- Enable PostgreSQL GENERATED columns
- All calculations automatic
- **No external computation needed**

### Phase 3: ML MODEL Columns
- Deploy ML models to prediction service
- Create API endpoints for predictions
- Batch scoring for historical data
- Real-time scoring for new records

### Data Flow
```
SAP/EDI â†’ RAW columns â†’ PostgreSQL Storage
         â†“
    ML Service â†’ ML MODEL columns â†’ PostgreSQL Storage
         â†“
    PostgreSQL â†’ DERIVED columns â†’ Auto-calculated

Frontend â† API â† PostgreSQL (RAW + DERIVED + ML)
```

---

**Last Updated:** 2025-10-25
**Total Tables Analyzed:** 40+
**Total Columns Categorized:** ~495 columns
