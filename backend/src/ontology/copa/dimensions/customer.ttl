@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix copa: <http://mantrix.ai/ontology/copa#> .
@prefix mantrix: <http://mantrix.ai/ontology#> .

copa:dim_customer a mantrix:Dimension ;
    rdfs:label "Customer" ;
    rdfs:comment "Customer dimension in COPA. Identified by Sold_to_Number/Sold_to_Name. Payer_Name is the parent company. Use for customer profitability, concentration, and segmentation analysis." ;
    skos:altLabel "client" , "buyer" , "account" , "sold-to party" , "customer" ;
    mantrix:bqColumns "Sold_to_Number, Sold_to_Name, Payer_Name" ;
    mantrix:exampleQuestion "Revenue by customer" ;
    mantrix:exampleSQL "SELECT Sold_to_Name, SUM(Gross_Sales) as revenue FROM dataset_25m_table GROUP BY Sold_to_Name ORDER BY revenue DESC" ;
    mantrix:exampleQuestion "Customer concentration (top 10 share)" ;
    mantrix:exampleSQL """SELECT
  SUM(CASE WHEN rn <= 10 THEN revenue ELSE 0 END) / SUM(revenue) * 100 as top10_pct
FROM (SELECT Sold_to_Name, SUM(Gross_Sales) as revenue,
  ROW_NUMBER() OVER (ORDER BY SUM(Gross_Sales) DESC) as rn
FROM dataset_25m_table GROUP BY Sold_to_Name)""" .
