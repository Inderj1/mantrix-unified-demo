<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STOX.AI | Tile 2 ‚Äî Demand vs Supply Command Center</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg-primary: #0a0f1a; --bg-secondary: #111827; --bg-tertiary: #1e293b; --border-color: #334155; --text-primary: #f8fafc; --text-secondary: #94a3b8; --text-muted: #64748b; --cyan-400: #22d3ee; --cyan-500: #06b6d4; --emerald-400: #34d399; --emerald-500: #10b981; --amber-400: #fbbf24; --amber-500: #f59e0b; --red-400: #f87171; --red-500: #ef4444; --purple-400: #c084fc; --purple-500: #a855f7; --pink-400: #f472b6; }
        body { font-family: 'JetBrains Mono', monospace; background: var(--bg-primary); background-image: radial-gradient(ellipse at 30% 20%, rgba(168, 85, 247, 0.1) 0%, transparent 50%), radial-gradient(ellipse at 70% 70%, rgba(6, 182, 212, 0.07) 0%, transparent 50%); color: var(--text-primary); min-height: 100vh; padding: 24px; }
        .container { max-width: 1800px; margin: 0 auto; }

        /* Header */
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 28px; padding-bottom: 20px; border-bottom: 1px solid rgba(71, 85, 105, 0.3); }
        .logo-section { display: flex; align-items: center; gap: 16px; }
        .logo { width: 52px; height: 52px; background: linear-gradient(135deg, var(--purple-500), var(--cyan-500)); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 26px; box-shadow: 0 8px 32px rgba(168, 85, 247, 0.3); }
        .brand h1 { font-size: 26px; font-weight: 700; background: linear-gradient(135deg, var(--purple-400), var(--cyan-400)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .brand p { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 3px; margin-top: 2px; }
        .tile-badge { background: linear-gradient(135deg, var(--purple-500), var(--cyan-500)); padding: 10px 20px; border-radius: 8px; font-size: 11px; font-weight: 600; letter-spacing: 1px; color: white; }
        .premise-banner { background: linear-gradient(135deg, rgba(168, 85, 247, 0.06), rgba(6, 182, 212, 0.04)); border: 1px solid rgba(168, 85, 247, 0.2); border-radius: 14px; padding: 20px 28px; margin-bottom: 28px; display: flex; align-items: center; gap: 16px; }
        .premise-banner .icon { font-size: 28px; } .premise-banner .text { font-size: 13px; color: var(--text-secondary); line-height: 1.6; } .premise-banner .text strong { color: var(--purple-400); }

        /* Dual-Lens Summary ‚Äî Quantities AND Capital side by side */
        .dual-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 28px; }
        .dual-panel { background: rgba(17, 24, 39, 0.7); border: 1px solid rgba(51, 65, 85, 0.4); border-radius: 16px; padding: 24px; }
        .dual-panel h3 { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .dual-panel h3.qty { color: var(--cyan-400); } .dual-panel h3.val { color: var(--purple-400); }
        .dual-panel h3 .sap-badge { margin-left: auto; font-size: 9px; padding: 3px 8px; border-radius: 4px; }
        .dual-panel h3 .sap-badge.cyan { color: rgba(6, 182, 212, 0.7); background: rgba(6, 182, 212, 0.1); }
        .dual-panel h3 .sap-badge.purple { color: rgba(168, 85, 247, 0.7); background: rgba(168, 85, 247, 0.1); }
        .dual-metrics { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .dual-metric { background: rgba(10, 15, 26, 0.5); border-radius: 10px; padding: 16px; text-align: center; border: 1px solid rgba(51, 65, 85, 0.3); }
        .dual-metric .label { font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
        .dual-metric .value { font-size: 24px; font-weight: 700; }
        .dual-metric .sub { font-size: 10px; color: var(--text-muted); margin-top: 4px; }

        /* Bottleneck Alert Strip */
        .bottleneck-strip { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 28px; }
        .bn-card { border-radius: 12px; padding: 16px 20px; display: flex; align-items: center; gap: 14px; }
        .bn-card.critical { background: rgba(239, 68, 68, 0.08); border: 1px solid rgba(239, 68, 68, 0.3); }
        .bn-card.warning { background: rgba(251, 191, 36, 0.08); border: 1px solid rgba(251, 191, 36, 0.3); }
        .bn-card.good { background: rgba(16, 185, 129, 0.08); border: 1px solid rgba(16, 185, 129, 0.3); }
        .bn-card.info { background: rgba(6, 182, 212, 0.08); border: 1px solid rgba(6, 182, 212, 0.3); }
        .bn-icon { font-size: 24px; } .bn-text .bn-val { font-size: 22px; font-weight: 700; } .bn-text .bn-label { font-size: 10px; color: var(--text-muted); margin-top: 2px; }

        /* Net Position Chart */
        .chart-section { background: rgba(17, 24, 39, 0.5); border: 1px solid rgba(51, 65, 85, 0.4); border-radius: 16px; padding: 24px; margin-bottom: 28px; }
        .chart-section h3 { font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .chart-section h3 .icon { color: var(--purple-400); }
        .chart-container-lg { height: 260px; }

        /* SKU Table */
        .table-section { background: rgba(17, 24, 39, 0.5); border: 1px solid rgba(51, 65, 85, 0.4); border-radius: 16px; overflow: hidden; }
        .table-header { display: flex; align-items: center; justify-content: space-between; padding: 20px 24px; border-bottom: 1px solid rgba(51, 65, 85, 0.4); background: linear-gradient(90deg, rgba(168, 85, 247, 0.08), rgba(6, 182, 212, 0.05)); }
        .table-header h2 { font-size: 14px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1.5px; } .table-header h2 span { color: var(--purple-400); }
        .table-filters { display: flex; gap: 12px; }
        .filter-select { background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px 12px; border-radius: 6px; font-family: inherit; font-size: 11px; cursor: pointer; }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { padding: 14px 10px; text-align: left; font-size: 9px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; background: rgba(10, 15, 26, 0.6); border-bottom: 1px solid rgba(51, 65, 85, 0.4); }
        .data-table th.qty-col { border-bottom: 2px solid rgba(6, 182, 212, 0.3); }
        .data-table th.val-col { border-bottom: 2px solid rgba(168, 85, 247, 0.3); }
        .data-table td { padding: 14px 10px; border-bottom: 1px solid rgba(51, 65, 85, 0.2); font-size: 11px; }
        .data-table tr { cursor: pointer; transition: all 0.2s; } .data-table tr:hover { background: rgba(168, 85, 247, 0.05); }
        .status-badge { display: inline-flex; align-items: center; gap: 5px; padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: 600; }
        .status-badge.short { background: rgba(239, 68, 68, 0.15); color: var(--red-400); border: 1px solid rgba(239, 68, 68, 0.3); }
        .status-badge.tight { background: rgba(251, 191, 36, 0.15); color: var(--amber-400); border: 1px solid rgba(251, 191, 36, 0.3); }
        .status-badge.covered { background: rgba(16, 185, 129, 0.15); color: var(--emerald-400); border: 1px solid rgba(16, 185, 129, 0.3); }
        .status-badge.excess { background: rgba(6, 182, 212, 0.15); color: var(--cyan-400); border: 1px solid rgba(6, 182, 212, 0.3); }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; }
        .status-dot.red { background: var(--red-500); box-shadow: 0 0 8px var(--red-500); animation: pulse 2s infinite; }
        .status-dot.yellow { background: var(--amber-500); box-shadow: 0 0 8px var(--amber-500); animation: pulse 2s infinite; }
        .status-dot.green { background: var(--emerald-500); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .metric-value { font-weight: 600; } .metric-value.good { color: var(--emerald-400); } .metric-value.warning { color: var(--amber-400); } .metric-value.critical { color: var(--red-400); } .metric-value.cyan { color: var(--cyan-400); } .metric-value.purple { color: var(--purple-400); }
        .drill-icon { opacity: 0; transition: all 0.2s; color: var(--purple-400); } .data-table tr:hover .drill-icon { opacity: 1; transform: translateX(4px); }

        /* Progress bar for coverage */
        .coverage-bar { width: 80px; height: 6px; background: rgba(51, 65, 85, 0.3); border-radius: 3px; overflow: hidden; display: inline-block; vertical-align: middle; margin-left: 8px; }
        .coverage-bar .fill { height: 100%; border-radius: 3px; }

        /* Detail View */
        .detail-view { display: none; } .detail-view.active { display: block; }
        .list-view { display: block; } .list-view.hidden { display: none; }
        .back-btn { display: flex; align-items: center; gap: 8px; padding: 10px 20px; background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(51, 65, 85, 0.4); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-family: inherit; font-size: 12px; margin-bottom: 24px; transition: all 0.2s; }
        .back-btn:hover { background: rgba(168, 85, 247, 0.1); color: var(--purple-400); border-color: rgba(168, 85, 247, 0.3); }
        .detail-header { display: flex; align-items: center; gap: 20px; margin-bottom: 28px; padding-bottom: 20px; border-bottom: 1px solid rgba(51, 65, 85, 0.3); }
        .detail-logo { width: 64px; height: 64px; background: linear-gradient(135deg, var(--purple-500), var(--cyan-500)); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 32px; }
        .detail-title h1 { font-size: 26px; font-weight: 700; } .detail-title h1 .material-id { color: var(--purple-400); } .detail-title h1 .sep { color: var(--text-muted); font-size: 18px; }
        .detail-title p { font-size: 13px; color: var(--text-muted); margin-top: 6px; }
        .detail-badges { margin-left: auto; }

        /* Waterfall Table */
        .waterfall-section { background: rgba(17, 24, 39, 0.5); border: 1px solid rgba(51, 65, 85, 0.4); border-radius: 16px; overflow: hidden; margin-bottom: 24px; }
        .waterfall-header { padding: 20px 24px; border-bottom: 1px solid rgba(51, 65, 85, 0.4); background: linear-gradient(90deg, rgba(168, 85, 247, 0.08), rgba(6, 182, 212, 0.05)); }
        .waterfall-header h3 { font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1.5px; display: flex; align-items: center; gap: 8px; }
        .waterfall-header h3 .icon { color: var(--purple-400); }
        .waterfall-table { width: 100%; border-collapse: collapse; }
        .waterfall-table th { padding: 12px 10px; text-align: left; font-size: 9px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; background: rgba(10, 15, 26, 0.6); border-bottom: 1px solid rgba(51, 65, 85, 0.4); }
        .waterfall-table td { padding: 14px 10px; border-bottom: 1px solid rgba(51, 65, 85, 0.15); font-size: 12px; }
        .waterfall-table tr.shortage { background: rgba(239, 68, 68, 0.04); }
        .waterfall-table tr.tight { background: rgba(251, 191, 36, 0.03); }
        .demand-tag { font-size: 9px; padding: 2px 6px; border-radius: 3px; margin-left: 4px; }
        .demand-tag.so { background: rgba(168, 85, 247, 0.2); color: var(--purple-400); }
        .demand-tag.fc { background: rgba(6, 182, 212, 0.2); color: var(--cyan-400); }
        .demand-tag.po { background: rgba(16, 185, 129, 0.2); color: var(--emerald-400); }
        .demand-tag.oh { background: rgba(251, 191, 36, 0.2); color: var(--amber-400); }

        /* Detail Cards */
        .detail-grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 24px; }
        .detail-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px; }
        .detail-grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
        .detail-card { background: rgba(17, 24, 39, 0.6); border: 1px solid rgba(51, 65, 85, 0.4); border-radius: 14px; padding: 20px; }
        .detail-card h3 { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .detail-card h3 .icon { color: var(--purple-400); } .detail-card h3 .sap-badge { margin-left: auto; font-size: 9px; color: rgba(168, 85, 247, 0.7); background: rgba(168, 85, 247, 0.1); padding: 3px 8px; border-radius: 4px; }
        .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(51, 65, 85, 0.2); } .info-row:last-child { border-bottom: none; }
        .info-row .label { font-size: 11px; color: var(--text-muted); } .info-row .value { font-size: 12px; font-weight: 600; color: var(--text-primary); }
        .mini-kpi { text-align: center; padding: 16px; background: rgba(10, 15, 26, 0.5); border-radius: 10px; border: 1px solid rgba(51, 65, 85, 0.3); }
        .mini-kpi .label { font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; } .mini-kpi .value { font-size: 22px; font-weight: 700; } .mini-kpi .sub { font-size: 10px; margin-top: 4px; }
        .chart-container { height: 180px; margin-top: 12px; }

        /* Order Detail rows */
        .order-row { display: grid; grid-template-columns: 1fr 120px 80px 80px 100px; gap: 10px; padding: 10px 0; border-bottom: 1px solid rgba(51, 65, 85, 0.15); align-items: center; font-size: 11px; }
        .order-row:last-child { border-bottom: none; }
        .order-id { color: var(--purple-400); font-weight: 600; }
        .order-customer { color: var(--text-secondary); }
        .order-qty { font-weight: 600; }
        .order-header { font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }

        /* AI Panel */
        .ai-panel { background: linear-gradient(135deg, rgba(168, 85, 247, 0.06), rgba(6, 182, 212, 0.04)); border: 1px solid rgba(168, 85, 247, 0.25); border-radius: 14px; padding: 24px; margin-top: 24px; position: relative; overflow: hidden; }
        .ai-panel::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--purple-500), var(--cyan-500), var(--purple-500)); background-size: 200% 100%; animation: shimmer 3s ease infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .ai-panel-header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .ai-icon { width: 40px; height: 40px; background: linear-gradient(135deg, var(--purple-500), var(--cyan-500)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .ai-panel-header h3 { font-size: 14px; font-weight: 600; color: var(--purple-400); margin: 0; } .ai-panel-header p { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
        .ai-confidence { margin-left: auto; text-align: right; } .ai-confidence .value { font-size: 20px; font-weight: 700; color: var(--emerald-400); } .ai-confidence .label { font-size: 9px; color: var(--text-muted); text-transform: uppercase; }
        .ai-recommendation { background: rgba(10, 15, 26, 0.5); border-radius: 10px; padding: 16px; margin-bottom: 16px; }
        .ai-recommendation .title { font-size: 12px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .ai-recommendation .title .priority { font-size: 9px; padding: 2px 8px; border-radius: 4px; font-weight: 600; }
        .ai-recommendation .title .priority.high { background: rgba(239, 68, 68, 0.2); color: var(--red-400); }
        .ai-recommendation .title .priority.medium { background: rgba(251, 191, 36, 0.2); color: var(--amber-400); }
        .ai-recommendation .content { font-size: 12px; color: var(--text-secondary); line-height: 1.6; }
        .ai-recommendation .impact { display: flex; gap: 20px; margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(51, 65, 85, 0.3); flex-wrap: wrap; }
        .ai-recommendation .impact-item { display: flex; align-items: center; gap: 6px; font-size: 11px; } .ai-recommendation .impact-item .label { color: var(--text-muted); } .ai-recommendation .impact-item .value { font-weight: 600; }
        .ai-actions { display: flex; gap: 12px; margin-top: 20px; }
        .ai-action-btn { padding: 10px 20px; border-radius: 8px; font-family: inherit; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; }
        .ai-action-btn.primary { background: linear-gradient(135deg, var(--purple-500), var(--cyan-500)); color: white; }
        .ai-action-btn.primary:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(168, 85, 247, 0.4); }
        .ai-action-btn.secondary { background: rgba(51, 65, 85, 0.5); color: var(--text-secondary); border: 1px solid rgba(51, 65, 85, 0.5); }
        .ai-action-btn.secondary:hover { background: rgba(168, 85, 247, 0.1); color: var(--purple-400); }

        .footer { display: flex; justify-content: space-between; align-items: center; margin-top: 32px; padding-top: 20px; border-top: 1px solid rgba(51, 65, 85, 0.2); font-size: 11px; color: var(--text-muted); }
        .footer .info { display: flex; gap: 16px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section"><div class="logo">‚ö°</div><div class="brand"><h1>STOX.AI</h1><p>Demand vs Supply Command Center</p></div></div>
            <div class="tile-badge">TILE 2 ‚Äî OPERATIONAL HEART</div>
        </div>
        <div class="premise-banner">
            <div class="icon">üéØ</div>
            <div class="text"><strong>What do I need? What do I have? Where's the gap? What does it cost?</strong><br>Real sales orders from SAP. ML-forecasted demand clearly separated. Total supply pipeline (on-hand + POs + planned). Net position in both units AND dollars. Every bottleneck priced. This is where planners live ‚Äî and where CFOs finally see what shortages actually cost.</div>
        </div>

        <div class="list-view" id="listView">
            <!-- Dual-Lens Summary -->
            <div class="dual-grid">
                <div class="dual-panel">
                    <h3 class="qty">üì¶ Quantity Position (Next 30 Days) <span class="sap-badge cyan">MARD / VBAP / EKPO</span></h3>
                    <div class="dual-metrics">
                        <div class="dual-metric"><div class="label">Total Demand</div><div class="value" style="color: var(--purple-400);">284,620 EA</div><div class="sub">SO: 186,420 | FC: 98,200</div></div>
                        <div class="dual-metric"><div class="label">Total Supply</div><div class="value" style="color: var(--cyan-400);">261,840 EA</div><div class="sub">OH: 148,240 | PO: 113,600</div></div>
                        <div class="dual-metric"><div class="label">Net Position</div><div class="value" style="color: var(--red-400);">-22,780 EA</div><div class="sub">92% coverage</div></div>
                    </div>
                </div>
                <div class="dual-panel">
                    <h3 class="val">üí∞ Capital Position (Next 30 Days) <span class="sap-badge purple">MBEW / ACDOCA</span></h3>
                    <div class="dual-metrics">
                        <div class="dual-metric"><div class="label">Demand Value</div><div class="value" style="color: var(--purple-400);">$68.4M</div><div class="sub">Revenue at risk if unfilled</div></div>
                        <div class="dual-metric"><div class="label">Supply Value</div><div class="value" style="color: var(--cyan-400);">$58.2M</div><div class="sub">Capital deployed in pipeline</div></div>
                        <div class="dual-metric"><div class="label">Gap Exposure</div><div class="value" style="color: var(--red-400);">$4.6M</div><div class="sub">Revenue at risk from shortages</div></div>
                    </div>
                </div>
            </div>

            <!-- Bottleneck Alert Strip -->
            <div class="bottleneck-strip">
                <div class="bn-card critical"><div class="bn-icon">üî¥</div><div class="bn-text"><div class="bn-val" style="color: var(--red-400);">34 SKUs</div><div class="bn-label">Shortage (&lt;7 days) ‚Äî 12,480 EA / $2.8M</div></div></div>
                <div class="bn-card warning"><div class="bn-icon">üü°</div><div class="bn-text"><div class="bn-val" style="color: var(--amber-400);">62 SKUs</div><div class="bn-label">Tight (7‚Äì14 days) ‚Äî 28,640 EA / $1.8M</div></div></div>
                <div class="bn-card good"><div class="bn-icon">üü¢</div><div class="bn-text"><div class="bn-val" style="color: var(--emerald-400);">1,842 SKUs</div><div class="bn-label">Covered (&gt;14 days) ‚Äî healthy</div></div></div>
                <div class="bn-card info"><div class="bn-icon">üîµ</div><div class="bn-text"><div class="bn-val" style="color: var(--cyan-400);">348 SKUs</div><div class="bn-label">Excess (&gt;90 days) ‚Äî $11.8M tied</div></div></div>
            </div>

            <!-- Net Position Chart -->
            <div class="chart-section">
                <h3><span class="icon">üìä</span> Aggregate Net Position ‚Äî Demand vs Supply (12 Weeks)</h3>
                <div class="chart-container-lg"><canvas id="netPositionChart"></canvas></div>
            </div>

            <!-- SKU Table with Dual Lens -->
            <div class="table-section">
                <div class="table-header">
                    <h2><span>Demand vs Supply</span> by Material ‚Äî Quantities & Capital</h2>
                    <div class="table-filters">
                        <select class="filter-select"><option>All Plants</option><option>P1000 - Detroit</option><option>P2000 - Phoenix</option><option>P3000 - Seattle</option></select>
                        <select class="filter-select"><option>All Status</option><option>üî¥ Shortage</option><option>üü° Tight</option><option>üü¢ Covered</option><option>üîµ Excess</option></select>
                        <select class="filter-select"><option>Sort: Gap EA ‚Üì</option><option>Sort: Gap $ ‚Üì</option><option>Sort: Coverage Days ‚Üë</option></select>
                    </div>
                </div>
                <table class="data-table">
                    <thead><tr>
                        <th>Material</th><th>Plant</th><th>Status</th>
                        <th class="qty-col">Demand (EA)</th><th class="qty-col">Supply (EA)</th><th class="qty-col">Gap (EA)</th><th class="qty-col">Coverage</th>
                        <th class="val-col">Demand ($)</th><th class="val-col">Gap ($)</th><th class="val-col">Margin</th><th></th>
                    </tr></thead>
                    <tbody>
                        <tr onclick="showDetail('MAT-1001')">
                            <td style="font-weight: 600;">MAT-1001</td><td>P1000</td>
                            <td><span class="status-badge short"><span class="status-dot red"></span>Shortage</span></td>
                            <td class="metric-value purple">3,200</td><td class="metric-value cyan">2,220</td><td class="metric-value critical">-980</td>
                            <td>4d <span class="coverage-bar"><span class="fill" style="width: 13%; background: var(--red-500);"></span></span></td>
                            <td class="metric-value purple">$640K</td><td class="metric-value critical">$196K</td><td>32.4%</td>
                            <td><span class="drill-icon">‚Üí</span></td>
                        </tr>
                        <tr onclick="showDetail('MAT-6200')">
                            <td style="font-weight: 600;">MAT-6200</td><td>P1000</td>
                            <td><span class="status-badge short"><span class="status-dot red"></span>Shortage</span></td>
                            <td class="metric-value purple">1,840</td><td class="metric-value cyan">920</td><td class="metric-value critical">-920</td>
                            <td>2d <span class="coverage-bar"><span class="fill" style="width: 7%; background: var(--red-500);"></span></span></td>
                            <td class="metric-value purple">$386K</td><td class="metric-value critical">$193K</td><td>28.1%</td>
                            <td><span class="drill-icon">‚Üí</span></td>
                        </tr>
                        <tr onclick="showDetail('MAT-3089')">
                            <td style="font-weight: 600;">MAT-3089</td><td>P1000</td>
                            <td><span class="status-badge tight"><span class="status-dot yellow"></span>Tight</span></td>
                            <td class="metric-value purple">4,620</td><td class="metric-value cyan">4,180</td><td class="metric-value warning">-440</td>
                            <td>11d <span class="coverage-bar"><span class="fill" style="width: 37%; background: var(--amber-500);"></span></span></td>
                            <td class="metric-value purple">$924K</td><td class="metric-value warning">$88K</td><td>41.2%</td>
                            <td><span class="drill-icon">‚Üí</span></td>
                        </tr>
                        <tr onclick="showDetail('MAT-2045')">
                            <td style="font-weight: 600;">MAT-2045</td><td>P2000</td>
                            <td><span class="status-badge covered"><span class="status-dot green"></span>Covered</span></td>
                            <td class="metric-value purple">2,800</td><td class="metric-value cyan">6,420</td><td class="metric-value good">+3,620</td>
                            <td>42d <span class="coverage-bar"><span class="fill" style="width: 70%; background: var(--emerald-500);"></span></span></td>
                            <td class="metric-value purple">$392K</td><td class="metric-value good">‚Äî</td><td>36.8%</td>
                            <td><span class="drill-icon">‚Üí</span></td>
                        </tr>
                        <tr onclick="showDetail('MAT-4012')">
                            <td style="font-weight: 600;">MAT-4012</td><td>P3000</td>
                            <td><span class="status-badge excess"><span class="status-dot green"></span>Excess</span></td>
                            <td class="metric-value purple">680</td><td class="metric-value cyan">4,840</td><td class="metric-value cyan">+4,160</td>
                            <td>128d <span class="coverage-bar"><span class="fill" style="width: 100%; background: var(--cyan-500);"></span></span></td>
                            <td class="metric-value purple">$88K</td><td class="metric-value cyan">$540K excess</td><td>22.4%</td>
                            <td><span class="drill-icon">‚Üí</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- LEVEL 3 DETAIL VIEW -->
        <div class="detail-view" id="detailView">
            <button class="back-btn" onclick="showList()">‚Üê Back to Command Center</button>
            <div class="detail-header">
                <div class="detail-logo">‚ö°</div>
                <div class="detail-title">
                    <h1><span class="material-id">MAT-1001</span> <span class="sep">@</span> P1000 ‚Äî Detroit</h1>
                    <p>Hydraulic Pump Assembly | UoM: EA | Std Cost: $200.00 | Avg Selling: $328.40 | Margin: 32.4%</p>
                </div>
                <div class="detail-badges"><span class="status-badge short"><span class="status-dot red"></span>Shortage ‚Äî 980 EA / $196K exposed</span></div>
            </div>

            <!-- Dual KPI Strip -->
            <div class="detail-grid-4">
                <div class="mini-kpi"><div class="label">On-Hand Stock</div><div class="value" style="color: var(--cyan-400);">1,420 EA</div><div class="sub" style="color: var(--text-muted);">$284K @ std cost</div></div>
                <div class="mini-kpi"><div class="label">Open POs</div><div class="value" style="color: var(--emerald-400);">800 EA</div><div class="sub" style="color: var(--text-muted);">2 POs, next ETA: Feb 10</div></div>
                <div class="mini-kpi"><div class="label">Total Demand (30d)</div><div class="value" style="color: var(--purple-400);">3,200 EA</div><div class="sub" style="color: var(--text-muted);">SO: 2,080 | FC: 1,120</div></div>
                <div class="mini-kpi"><div class="label">Net Gap</div><div class="value" style="color: var(--red-400);">-980 EA</div><div class="sub" style="color: var(--red-400);">$196K revenue at risk</div></div>
            </div>

            <!-- Supply/Demand Waterfall ‚Äî THE CORE -->
            <div class="waterfall-section">
                <div class="waterfall-header"><h3><span class="icon">üåä</span> Supply / Demand Waterfall ‚Äî Week by Week</h3></div>
                <table class="waterfall-table">
                    <thead><tr>
                        <th>Period</th><th>Demand (EA)</th><th>Source</th><th>Supply (EA)</th><th>Source</th><th>Net (EA)</th><th>Cum. Position</th><th>$ Exposure</th>
                    </tr></thead>
                    <tbody>
                        <tr>
                            <td style="font-weight: 600;">Opening</td><td>‚Äî</td><td>‚Äî</td><td style="color: var(--cyan-400); font-weight: 600;">+1,420</td>
                            <td><span class="demand-tag oh">OH</span> MARD</td>
                            <td>‚Äî</td><td style="color: var(--emerald-400); font-weight: 600;">+1,420</td><td>‚Äî</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600;">Week 1</td><td style="color: var(--purple-400);">-680</td>
                            <td><span class="demand-tag so">SO</span> 3 orders</td>
                            <td style="color: var(--emerald-400);">+500</td><td><span class="demand-tag po">PO</span> 4500018923</td>
                            <td style="color: var(--emerald-400);">+320</td><td style="color: var(--emerald-400); font-weight: 600;">+1,240</td><td>‚Äî</td>
                        </tr>
                        <tr class="tight">
                            <td style="font-weight: 600;">Week 2</td><td style="color: var(--purple-400);">-920</td>
                            <td><span class="demand-tag so">SO</span> 480 + <span class="demand-tag fc">FC</span> 440</td>
                            <td style="color: var(--text-muted);">‚Äî</td><td style="color: var(--text-muted);">none</td>
                            <td style="color: var(--red-400);">-920</td><td style="color: var(--amber-400); font-weight: 600;">+320</td><td>‚Äî</td>
                        </tr>
                        <tr class="shortage">
                            <td style="font-weight: 600;">Week 3</td><td style="color: var(--purple-400);">-840</td>
                            <td><span class="demand-tag so">SO</span> 320 + <span class="demand-tag fc">FC</span> 520</td>
                            <td style="color: var(--emerald-400);">+300</td><td><span class="demand-tag po">PO</span> 4500019104</td>
                            <td style="color: var(--red-400);">-540</td><td style="color: var(--red-400); font-weight: 600;">-220</td><td style="color: var(--red-400); font-weight: 600;">$44K</td>
                        </tr>
                        <tr class="shortage">
                            <td style="font-weight: 600;">Week 4</td><td style="color: var(--purple-400);">-760</td>
                            <td><span class="demand-tag fc">FC</span> 760</td>
                            <td style="color: var(--text-muted);">‚Äî</td><td style="color: var(--text-muted);">none</td>
                            <td style="color: var(--red-400);">-760</td><td style="color: var(--red-400); font-weight: 600;">-980</td><td style="color: var(--red-400); font-weight: 600;">$196K</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Detail Grid: Orders + Forecast + Supply -->
            <div class="detail-grid-3">
                <div class="detail-card">
                    <h3><span class="icon">üìã</span> Real Sales Orders (Confirmed) <span class="sap-badge">VBAK / VBAP</span></h3>
                    <div class="order-row" style="border-bottom: 1px solid rgba(51,65,85,0.3);"><span class="order-header">Order</span><span class="order-header">Customer</span><span class="order-header">Qty</span><span class="order-header">Due</span><span class="order-header">Value</span></div>
                    <div class="order-row"><span class="order-id">SO 300012847</span><span class="order-customer">Boeing</span><span class="order-qty" style="color: var(--purple-400);">400 EA</span><span>Feb 12</span><span>$131K</span></div>
                    <div class="order-row"><span class="order-id">SO 300012901</span><span class="order-customer">Raytheon</span><span class="order-qty" style="color: var(--purple-400);">180 EA</span><span>Feb 14</span><span>$59K</span></div>
                    <div class="order-row"><span class="order-id">SO 300013042</span><span class="order-customer">L3Harris</span><span class="order-qty" style="color: var(--purple-400);">100 EA</span><span>Feb 15</span><span>$33K</span></div>
                    <div class="order-row"><span class="order-id">SO 300013188</span><span class="order-customer">Northrop</span><span class="order-qty" style="color: var(--purple-400);">480 EA</span><span>Feb 19</span><span>$158K</span></div>
                    <div class="order-row"><span class="order-id">SO 300013294</span><span class="order-customer">GE Aero</span><span class="order-qty" style="color: var(--purple-400);">320 EA</span><span>Feb 22</span><span>$105K</span></div>
                    <div class="info-row" style="margin-top: 8px;"><span class="label">Total Confirmed SOs</span><span class="value" style="color: var(--purple-400);">2,080 EA / $682K</span></div>
                </div>
                <div class="detail-card">
                    <h3><span class="icon">üîÆ</span> ML Forecast (Predicted) <span class="sap-badge">STOX.AI</span></h3>
                    <div class="info-row"><span class="label">Model</span><span class="value">XGBoost + Seasonal</span></div>
                    <div class="info-row"><span class="label">Forecast Qty (30d)</span><span class="value" style="color: var(--cyan-400);">1,120 EA</span></div>
                    <div class="info-row"><span class="label">Confidence (P50)</span><span class="value" style="color: var(--emerald-400);">78%</span></div>
                    <div class="info-row"><span class="label">P10 (downside)</span><span class="value">840 EA</span></div>
                    <div class="info-row"><span class="label">P90 (upside)</span><span class="value">1,480 EA</span></div>
                    <div class="info-row"><span class="label">CV (historical)</span><span class="value" style="color: var(--amber-400);">0.82 (erratic)</span></div>
                    <div class="info-row"><span class="label">Forecast Value (P50)</span><span class="value" style="color: var(--cyan-400);">$368K revenue</span></div>
                    <div class="chart-container"><canvas id="forecastChart"></canvas></div>
                </div>
                <div class="detail-card">
                    <h3><span class="icon">üöö</span> Supply Pipeline <span class="sap-badge">EKPO / EKBE</span></h3>
                    <div class="info-row"><span class="label">On-Hand (MARD)</span><span class="value" style="color: var(--cyan-400);">1,420 EA / $284K</span></div>
                    <div class="info-row"><span class="label">PO 4500018923 (VENDOR-A)</span><span class="value" style="color: var(--emerald-400);">500 EA / Feb 10</span></div>
                    <div class="info-row"><span class="label">‚Ü≥ OTD Probability</span><span class="value" style="color: var(--amber-400);">72% (LT-CV: 0.52)</span></div>
                    <div class="info-row"><span class="label">PO 4500019104 (VENDOR-A)</span><span class="value" style="color: var(--emerald-400);">300 EA / Feb 21</span></div>
                    <div class="info-row"><span class="label">‚Ü≥ OTD Probability</span><span class="value" style="color: var(--amber-400);">72%</span></div>
                    <div class="info-row"><span class="label">Planned Orders (MRP)</span><span class="value" style="color: var(--text-muted);">0 EA (not yet released)</span></div>
                    <div class="info-row" style="margin-top: 8px; padding-top: 12px; border-top: 1px solid rgba(51,65,85,0.3);"><span class="label">Total Pipeline</span><span class="value" style="color: var(--cyan-400);">2,220 EA / $444K</span></div>
                    <div class="info-row"><span class="label">Risk-Adjusted Supply</span><span class="value" style="color: var(--amber-400);">1,996 EA (OTD-weighted)</span></div>
                </div>
            </div>

            <!-- Visual: Demand vs Supply Chart -->
            <div class="detail-grid-2">
                <div class="detail-card">
                    <h3><span class="icon">üìä</span> Cumulative Demand vs Supply</h3>
                    <div class="chart-container" style="height: 200px;"><canvas id="waterfallChart"></canvas></div>
                </div>
                <div class="detail-card">
                    <h3><span class="icon">üí∞</span> Financial Exposure by Week</h3>
                    <div class="info-row"><span class="label">Week 1‚Äì2: Fully covered</span><span class="value" style="color: var(--emerald-400);">$0 at risk</span></div>
                    <div class="info-row"><span class="label">Week 3: 220 EA short</span><span class="value" style="color: var(--red-400);">$44K at risk</span></div>
                    <div class="info-row"><span class="label">Week 4: 980 EA short</span><span class="value" style="color: var(--red-400);">$196K at risk</span></div>
                    <div class="info-row"><span class="label">Top customer affected</span><span class="value" style="color: var(--red-400);">Northrop (480 EA / $158K)</span></div>
                    <div class="info-row"><span class="label">Margin at risk (32.4%)</span><span class="value" style="color: var(--red-400);">$63.5K gross profit</span></div>
                    <div class="info-row" style="margin-top: 8px; padding-top: 12px; border-top: 1px solid rgba(51,65,85,0.3);"><span class="label">If VENDOR-A late (+7d):</span><span class="value" style="color: var(--red-400);">Gap widens to 1,480 EA / $296K</span></div>
                    <div class="info-row"><span class="label">Optimal SL (from Tile 4):</span><span class="value" style="color: var(--purple-400);">97% ‚Üí justified by margin</span></div>
                </div>
            </div>

            <!-- AI Panel -->
            <div class="ai-panel">
                <div class="ai-panel-header">
                    <div class="ai-icon">ü§ñ</div>
                    <div><h3>STOX.AI Demand-Supply Intelligence</h3><p>Pelico shows you the gap. We show you the gap AND what it costs AND what to do about it.</p></div>
                    <div class="ai-confidence"><div class="value">86%</div><div class="label">Action Confidence</div></div>
                </div>
                <div class="ai-recommendation">
                    <div class="title">üî¥ 980 EA Shortage in Week 4 ‚Äî $196K Revenue at Risk <span class="priority high">ACT NOW</span></div>
                    <div class="content">
                        <strong>The Bottleneck:</strong> MAT-1001 goes negative in Week 3 (-220 EA) and deepens to -980 EA by Week 4. The root cause is a supply gap: only 2 POs totaling 800 EA against 3,200 EA demand. VENDOR-A's 72% OTD probability means the 500 EA PO (Feb 10) has a 28% chance of arriving late ‚Äî which would push the shortage to Week 2.<br><br>
                        <strong>Recommended Actions (ranked by impact):</strong><br>
                        1. <strong>Expedite PO 4500019104</strong> ‚Äî pull 300 EA from Feb 21 ‚Üí Feb 14. Reduces Week 3 gap from 220 EA to 0. Cost: ~$2.4K expedite premium.<br>
                        2. <strong>Create emergency PO: 700 EA to VENDOR-B</strong> (89% OTD, 12d lead time). Covers remaining Week 4 gap. Unit cost +4.2% vs VENDOR-A but arrival probability far higher.<br>
                        3. <strong>If both actions taken:</strong> Net position stays positive through Week 4. Revenue protected: $196K. Margin protected: $63.5K.<br><br>
                        <strong>What Pelico would show you:</strong> "980 EA short, consider expediting." <br>
                        <strong>What STOX.AI shows you:</strong> The shortage costs $196K in revenue, $63.5K in margin. Northrop's 480 EA order is the highest-value order at risk. Expediting PO 4500019104 costs $2.4K and saves $44K. Creating a backup PO to VENDOR-B costs 4.2% more per unit but has 89% OTD vs 72%. The total cost of resolution: $8.6K. The cost of inaction: $196K.
                    </div>
                    <div class="impact">
                        <div class="impact-item"><span class="label">Gap Closed:</span><span class="value" style="color: var(--emerald-400);">980 EA ‚Üí 0 EA</span></div>
                        <div class="impact-item"><span class="label">Revenue Protected:</span><span class="value" style="color: var(--emerald-400);">$196K</span></div>
                        <div class="impact-item"><span class="label">Action Cost:</span><span class="value" style="color: var(--amber-400);">$8.6K</span></div>
                        <div class="impact-item"><span class="label">ROI of Action:</span><span class="value" style="color: var(--emerald-400);">22.8√ó</span></div>
                    </div>
                </div>
                <div class="ai-actions">
                    <button class="ai-action-btn primary">üì¶ Create Emergency PO (700 EA)</button>
                    <button class="ai-action-btn secondary">‚ö° Expedite PO 4500019104</button>
                    <button class="ai-action-btn secondary">üìä Run Scenario: VENDOR-A Late +7d</button>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="info"><span>STOX.AI Demand vs Supply Command Center</span><span>‚Ä¢</span><span>Tile 2 of 6</span><span>‚Ä¢</span><span>Layer: Operational Heart</span><span>‚Ä¢</span><span>Last Refresh: <span id="refreshTime"></span></span></div>
            <div>¬© 2025 Cloud Mantra LLC | Mantrix.AI</div>
        </div>
    </div>
    <script>
        function showDetail(m) { document.getElementById('listView').classList.add('hidden'); document.getElementById('detailView').classList.add('active'); setTimeout(renderCharts, 100); }
        function showList() { document.getElementById('listView').classList.remove('hidden'); document.getElementById('detailView').classList.remove('active'); }
        let npChart, fcChart, wfChart;
        function renderCharts() {
            // Forecast chart
            const fc = document.getElementById('forecastChart').getContext('2d');
            if (fcChart) fcChart.destroy();
            fcChart = new Chart(fc, { type: 'line', data: { labels: ['W1','W2','W3','W4','W5','W6','W7','W8'],
                datasets: [
                    { label: 'Actual', data: [310,280,340,null,null,null,null,null], borderColor: '#a855f7', borderWidth: 2, pointRadius: 3, pointBackgroundColor: '#a855f7' },
                    { label: 'Forecast (P50)', data: [null,null,null,280,260,300,280,300], borderColor: '#22d3ee', borderWidth: 2, borderDash: [6,3], pointRadius: 3, pointBackgroundColor: '#22d3ee' },
                    { label: 'P10‚ÄìP90 Band', data: [null,null,null,210,195,225,210,225], borderColor: 'transparent', backgroundColor: 'rgba(34,211,238,0.1)', fill: '+1', pointRadius: 0 },
                    { label: '', data: [null,null,null,370,345,400,370,400], borderColor: 'transparent', backgroundColor: 'rgba(34,211,238,0.1)', fill: '-1', pointRadius: 0 }
                ]}, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: true, position: 'top', labels: { color: '#94a3b8', font: { size: 8 }, boxWidth: 8, filter: i => i.text !== '' } } },
                scales: { x: { grid: { display: false }, ticks: { color: '#64748b', font: { size: 9 } } }, y: { grid: { color: 'rgba(51,65,85,0.2)' }, ticks: { color: '#64748b', font: { size: 9 } }, title: { display: true, text: 'EA/week', color: '#64748b', font: { size: 9 } } } } }
            });
            // Waterfall chart
            const wf = document.getElementById('waterfallChart').getContext('2d');
            if (wfChart) wfChart.destroy();
            wfChart = new Chart(wf, { type: 'line', data: { labels: ['Open','W1','W2','W3','W4'],
                datasets: [
                    { label: 'Cum. Demand', data: [0,680,1600,2440,3200], borderColor: '#a855f7', backgroundColor: 'rgba(168,85,247,0.1)', borderWidth: 2, fill: false, tension: 0.2, pointRadius: 4, pointBackgroundColor: '#a855f7' },
                    { label: 'Cum. Supply', data: [1420,1920,1920,2220,2220], borderColor: '#22d3ee', backgroundColor: 'rgba(34,211,238,0.1)', borderWidth: 2, fill: false, tension: 0.2, pointRadius: 4, pointBackgroundColor: '#22d3ee' }
                ]}, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: true, position: 'top', labels: { color: '#94a3b8', font: { size: 9 }, boxWidth: 10 } } },
                scales: { x: { grid: { display: false }, ticks: { color: '#64748b', font: { size: 10 } } }, y: { grid: { color: 'rgba(51,65,85,0.2)' }, ticks: { color: '#64748b', font: { size: 10 }, callback: v => v.toLocaleString() + ' EA' } } } }
            });
        }
        // Aggregate Net Position Chart (L1)
        const npCtx = document.getElementById('netPositionChart').getContext('2d');
        npChart = new Chart(npCtx, { type: 'bar', data: { labels: ['W1','W2','W3','W4','W5','W6','W7','W8','W9','W10','W11','W12'],
            datasets: [
                { label: 'Demand (EA)', data: [-24200,-28400,-26800,-31200,-29600,-27400,-30100,-28800,-26200,-29400,-27800,-30600], backgroundColor: 'rgba(168,85,247,0.5)', borderRadius: 3 },
                { label: 'Supply (EA)', data: [22800,18600,24200,26400,28800,25600,27200,30400,28600,26800,29200,27400], backgroundColor: 'rgba(34,211,238,0.5)', borderRadius: 3 },
                { type: 'line', label: 'Net Position', data: [-1400,-9800,-2600,-4800,-800,-1800,-2900,1600,2400,-2600,1400,-3200], borderColor: '#f87171', borderWidth: 2, pointRadius: 3, pointBackgroundColor: '#f87171', yAxisID: 'y1' }
            ]}, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: true, position: 'top', labels: { color: '#94a3b8', font: { size: 9 }, boxWidth: 10 } } },
            scales: { x: { grid: { display: false }, ticks: { color: '#64748b', font: { size: 9 } } }, y: { grid: { color: 'rgba(51,65,85,0.2)' }, ticks: { color: '#64748b', font: { size: 9 }, callback: v => (v/1000).toFixed(0)+'K' } }, y1: { position: 'right', grid: { display: false }, ticks: { color: '#f87171', font: { size: 9 }, callback: v => (v/1000).toFixed(0)+'K' } } } }
        });
        document.getElementById('refreshTime').textContent = new Date().toLocaleString();
    </script>
</body>
</html>
